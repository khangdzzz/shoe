import{_ as xe}from"./BxUkqd-y.js";import{_ as oe}from"./BnR97QSv.js";import{_ as ne}from"./DI1eqzAo.js";import{C as le,j as ye,V as be,S as Se,u as re,A as ke,a as we,f as Ce,_ as $e}from"./b0gmyfeB.js";import{C as De}from"./BKI6R6_z.js";import{m as K,r as m,J as X,g as ce,o as d,c as S,a as e,b as _,w as G,p as s,d as H,t as y,H as ie,A as M,K as Ee,L as Ae,v as z,x as I,N as Ie,h as Ue,E as Q,G as W,n as ue,y as Me,O as Ne,D as se,S as F,M as Re}from"./DSqI6PPL.js";import{_ as Z}from"./DlAUqK2U.js";import{u as de}from"./Cd0njtKa.js";import{u as ee}from"./I24nPOIp.js";import{L as ae}from"./BnW9Z-pt.js";import{C as Le}from"./BRAAPdHj.js";import{_ as Pe}from"./C6QCpjMs.js";import{_ as Te}from"./6c_3vuge.js";import"./DIqocVxG.js";import"./DxiFBGg3.js";const Ve={class:"date-search flex items-center gap-3"},ze={class:"flex items-center gap-2"},Ye={class:"border border-gray-300 h-[30px] flex items-center justify-between px-4 bg-white rounded cursor-pointer"},je=K({__name:"date",emits:["update:selectedDate"],setup(Y,{emit:D}){const k=D,u=m((()=>{const x=new Date,a=x.getFullYear(),c=x.getMonth()+1;return{year:a,month:c}})()),r=m(""),w=()=>{const{year:x,month:a}=u.value;r.value=`${x}/${a.toString().padStart(2,"0")}`,k("update:selectedDate",r.value)},h=x=>{let{year:a,month:c}=u.value;c+=x,c>12?(c=1,a+=1):c<1&&(c=12,a-=1),g.value={year:a,month:c-1}};X(()=>{w()});const g=m({year:u.value.year,month:u.value.month-1});return ce(g,()=>{u.value={year:g.value.year,month:g.value.month+1},w()}),(x,a)=>{const c=ne;return d(),S("div",Ve,[e("div",ze,[_(c,{variant:"default",class:"bg-[#bfbfbf] text-black hover:bg-[#c4b3b3]","left-icon":"search",onClick:a[0]||(a[0]=$=>h(-1))},{default:G(()=>[_(s(le),{class:"w-4 h-4"}),a[2]||(a[2]=H(" 前月 "))]),_:1}),_(s(be),{modelValue:s(g),"onUpdate:modelValue":a[1]||(a[1]=$=>ie(g)?g.value=$:null),"month-picker":"","auto-apply":"","format-locale":s(ye),format:"E"},{trigger:G(()=>[e("div",Ye,[e("span",null,y(s(r)),1),_(s(De),{class:"w-4 h-4"})])]),_:1},8,["modelValue","format-locale"])])])}}}),Be=Z(je,[["__scopeId","data-v-0df9fc12"]]),Oe={class:"search flex flex-col gap-8 min-h-[100px]"},Fe={class:"company flex max-sm:flex-col gap-5"},Ge={class:"relative items-center font-medium lg:w-[450px]"},He={class:"absolute start-0 inset-y-0 flex items-center justify-center px-2"},Ke={class:"active flex gap-5"},Ze={class:"flex items-center gap-2"},Je={class:"flex items-center gap-2"},qe={class:"flex items-center gap-2"},Qe={class:"actions flex max-sm:flex-col gap-5"},We={class:"flex gap-5 lg:w-[450px]"},Xe={class:"flex gap-5"},et=K({__name:"index",emits:["update:changeDate","update:changeStatus","searchCompany","exportCustomer","exportStatusCompany"],setup(Y,{emit:D}){const{redirectPage:k}=de(),v=ee(),u=D,r=m(""),w=m([]),h=m(""),g=m(!1),x=M(()=>v.isLoadingExportCompany),a=M(()=>v.isLoadingExportStatusCompany),c=i=>{r.value=i,u("update:changeDate",r.value)},$=(i,o)=>{o?w.value.push(i):w.value=w.value.filter(A=>A!==i),u("update:changeStatus",w.value)},E=()=>{k("/customer/create-new-customer")},R=()=>{u("exportCustomer")},T=()=>{u("exportStatusCompany")},V=()=>{if(g.value){g.value=!1;return}u("searchCompany",h.value)},p=i=>{g.value=!0,i.target.blur(),u("searchCompany",h.value)};return(i,o)=>{const A=xe,L=oe,P=ne,j=Be;return d(),S("div",Oe,[e("div",Fe,[e("div",Ge,[_(A,{id:"search",type:"text",placeholder:"Search...",class:"pl-10 w-[70%]",modelValue:s(h),"onUpdate:modelValue":o[0]||(o[0]=n=>ie(h)?h.value=n:null),onBlur:V,onKeydown:Ee(Ae(p,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),e("span",He,[_(s(Se),{class:"w-4 h-4"})])]),e("div",Ke,[e("div",Ze,[_(L,{id:"normal",class:"bg-white","onUpdate:checked":o[1]||(o[1]=n=>$(1,n))}),o[4]||(o[4]=e("span",{for:"suspension",class:"flex text-xs flex-shrink-0"}," 利用中 ",-1))]),e("div",Je,[_(L,{id:"terms",class:"bg-white","onUpdate:checked":o[2]||(o[2]=n=>$(2,n))}),o[5]||(o[5]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 停止中 ",-1))]),e("div",qe,[_(L,{id:"temporary",class:"bg-white","onUpdate:checked":o[3]||(o[3]=n=>$(3,n))}),o[6]||(o[6]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 退会済 ",-1))])])]),e("div",Qe,[e("div",We,[_(P,{variant:"export","left-icon":"search",class:"cursor-pointer",onClick:E},{default:G(()=>o[7]||(o[7]=[H(" 新規顧客追加 ")])),_:1}),_(P,{variant:"export","left-icon":"search",onClick:R},{default:G(()=>[s(x)?(d(),z(s(ae),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):I("",!0),o[8]||(o[8]=H(" 顧客情報出力 "))]),_:1})]),e("div",Xe,[_(j,{"onUpdate:selectedDate":c}),_(P,{variant:"export","left-icon":"search",onClick:T},{default:G(()=>[s(a)?(d(),z(s(ae),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):I("",!0),o[9]||(o[9]=H(" 利用状況出力 "))]),_:1})])])])}}}),tt=Z(et,[["__scopeId","data-v-48888dc7"]]),st={class:"pagination max-w-[350px]"},at={class:"flex items-center gap-5 justify-between"},ot={class:"flex items-center gap-2"},nt={class:"text-center"},lt={key:0,class:"dropdown-content absolute left-0 mt-1 w-full bg-white shadow-xl z-12"},rt=["onClick"],ct={class:"flex items-center gap-2"},it={key:0,class:"from"},ut={key:1},dt={key:2},pt={key:3,class:"to"},mt={key:4},ft={key:5,class:"total"},vt={class:"flex items-center gap-2"},_t=["disabled"],ht=["disabled"],gt=K({__name:"pagination",props:{length:{type:Number,default:100}},emits:["update:pagination"],setup(Y,{emit:D}){const k=Y,{length:v}=Ie(k),u=m("30"),r=m(1),w=[30,100,200],h=m(!1),g=m(null),x=D,a=M(()=>Math.ceil(v.value/parseInt(u.value))),c=M(()=>v.value===0?0:(r.value-1)*parseInt(u.value)+1),$=M(()=>{if(v.value===0)return 0;const i=r.value*parseInt(u.value);return i>v.value?v.value:i}),E=i=>{u.value=i.toString(),r.value=1,h.value=!1,x("update:pagination",{pageIndex:r.value,pageSize:i})},R=()=>{r.value>1&&(r.value--,x("update:pagination",{pageIndex:r.value,pageSize:parseInt(u.value)}))},T=()=>{r.value<a.value&&(r.value++,x("update:pagination",{pageIndex:r.value,pageSize:parseInt(u.value)}))},V=M(()=>r.value>=a.value||v.value===0),p=i=>{g.value&&!g.value.contains(i.target)&&(h.value=!1)};return X(()=>{window.addEventListener("click",p)}),Ue(()=>{window.removeEventListener("click",p)}),(i,o)=>(d(),S("div",st,[e("div",at,[e("div",ot,[o[2]||(o[2]=e("span",null,"表示数:",-1)),e("div",{class:"relative",ref_key:"dropdownRef",ref:g},[e("button",{onClick:o[0]||(o[0]=A=>h.value=!h.value),class:"w-[60px] flex justify-between items-center px-2 py-1"},[e("span",nt,y(u.value),1),o[1]||(o[1]=e("div",{class:"w-0 h-0 border-l-[5px] border-r-[5px] border-t-[5px] border-transparent border-t-gray-500 hover:border-t-gray-700"},null,-1))]),h.value?(d(),S("div",lt,[e("ul",null,[(d(),S(Q,null,W(w,A=>e("li",{key:A,onClick:L=>E(A),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},y(A),9,rt)),64))])])):I("",!0)],512),e("div",ct,[s(v)>0?(d(),S("span",it,y(c.value),1)):(d(),S("span",ut,"0")),s(v)>0?(d(),S("span",dt,"-")):I("",!0),s(v)>0?(d(),S("span",pt,y($.value)+" 件",1)):(d(),S("span",mt,"件")),s(v)>0?(d(),S("span",ft,"(全"+y(s(v))+"件)",1)):I("",!0)])]),e("div",vt,[e("button",{onClick:R,disabled:r.value===1||s(v)===0,class:"disabled:opacity-50"},[_(s(le),{class:"w-4 h-4"})],8,_t),e("button",{onClick:T,disabled:V.value,class:"disabled:opacity-50"},[_(s(Le),{class:"w-4 h-4"})],8,ht)])])]))}}),xt=Z(gt,[["__scopeId","data-v-f974aacb"]]),yt={},bt={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function St(Y,D){return d(),S("svg",bt,D[0]||(D[0]=[e("path",{d:"M15.8333 2.5H4.16667C3.25 2.5 2.5 3.25 2.5 4.16667V15.8333C2.5 16.75 3.25 17.5 4.16667 17.5H15.8333C16.75 17.5 17.5 16.75 17.5 15.8333V4.16667C17.5 3.25 16.75 2.5 15.8333 2.5ZM14.1667 10.8333H5.83333V9.16667H14.1667V10.8333Z",fill:"#343DD6"},null,-1)]))}const kt=Z(yt,[["render",St]]),wt={class:"user-container flex flex-col gap-2 overflow-hidden"},Ct={class:"actions flex justify-between items-center"},$t={class:"w-full flex flex-col relative border-l border-r"},Dt={class:"table-container overflow-auto border-b"},Et={class:"w-full table-fixed"},At={class:"bg-[#afeeee] sticky top-0 z-10"},It={class:"flex items-center justify-center px-4 py-[1px] text-black border-white border-r-2"},Ut=["onClick"],Mt={class:""},Nt=["onDblclick"],Rt={class:"pr-[1px]"},Lt={class:"row-sticky px-[5px]"},Pt={class:"row-sticky px-[5px]"},Tt={class:"px-[5px]"},Vt={class:"px-[5px]"},zt={class:"px-[5px]"},Yt={class:"px-[5px]"},jt={class:"px-[5px] text-center"},Bt={class:"px-[5px] text-center"},Ot={class:"px-[5px] text-center"},Ft={key:1},Gt={colspan:"9",class:"text-center py-4 text-[#5566da]"},Ht=K({__name:"index",emits:["update:pagination","update:sort","getCompanies","selectRow"],setup(Y,{emit:D}){const k=ee(),v=ue(),u=Me(),{redirectPage:r}=de(),{toast:w}=re(),h=D,g={1:"利用中",2:"停止中",3:"退会済"},x=[{label:"法人名",width:"10%",isSort:!0,key:"companyName"},{label:"所在地",width:"15%",isSort:!0,key:"companyAddress"},{label:"電話番号",width:"9%",isSort:!0,key:"phoneNumber"},{label:"代表者",width:"9%",isSort:!0,key:"frontPicFamilyName"},{label:"担当者",width:"9%",isSort:!0,key:"picFamilyName"},{label:"メールアドレス",width:"15%",isSort:!0,key:"email"},{label:"介護ソフト",width:"10%",isSort:!0,key:"kaigoSoftware"},{label:"ステータス",width:"9%",isSort:!0,key:"status"},{label:"開始日",width:"9%",isSort:!0,key:"createdAt"}],a=m(1),c=m(""),$=m(!1),E=M(()=>{var t;return((t=k.companyUsers)==null?void 0:t.totalRecord)??0}),R=M(()=>k.isLoadCompanyCustomers),T=M(()=>v.notify),V=M(()=>u.masterData),p=m(new Set),i=M(()=>{var t,l;return p.value=new Set,a.value==0&&(p.value=new Set((t=k.companyUsers)==null?void 0:t.results.map(b=>b.id))),((l=k.companyUsers)==null?void 0:l.results)??[]}),o=t=>{t?(a.value=0,p.value=new Set(i.value.map(l=>l.id))):(a.value=1,p.value.clear())},A=t=>{p.value.has(t)?p.value.delete(t):p.value.add(t);const l=i.value.length,b=p.value.size;b===0?a.value=1:b===l?a.value=0:a.value===0&&b<l&&(a.value=2)},L=()=>{o(!1)};ce(p,()=>{const t=[],l=[],b=j();b?i.value.forEach(U=>{p.value.has(U.id)||t.push(U.id)}):l.push(...p.value),h("selectRow",{exceptionIds:t,checkedIds:l,selectedAll:b})},{deep:!0});const P=t=>t?g[t]:t=0,j=()=>a.value===0||a.value===2,n=({pageIndex:t,pageSize:l})=>{h("update:pagination",{pageIndex:t,pageSize:l})},C=t=>{if(!t.isSort)return;const[l,b]=c.value.split(":"),U=l===t.key?b===F.ASC?F.DESC:"":F.ASC;c.value=U?`${t.key}:${U}`:"",h("update:sort",c.value)},N=()=>{if(p.value.size==0){J("destructive","削除する会社を選択してください");return}$.value=!0},B=async()=>{var b;k.isLoadCompanyCustomers=!0,$.value=!1;const t=Array.from(p.value);if(await k.bulkDelete(t),(b=T.value)!=null&&b.message){k.isLoadCompanyCustomers=!1;return}J("default","会社を削除しました"),h("getCompanies")},pe=()=>{if(p.value.size==0){J("destructive","編集する会社を選択してください");return}if(p.value.size>1){J("destructive","編集する会社を1つだけ選択してください");return}r(`/customer/detail/${p.value.values().next().value}`)},me=t=>{r(`/customer/detail/${t}`)},J=(t,l)=>{w({description:l,variant:t,duration:1e3})},fe=t=>{let l="bg-white dark:bg-gray-800 h-10 hover:cursor-pointer ";if(!t||t==1)return l+="hover:bg-[#afe7ee47]";if(t==2)return l+="!bg-[#feffce]";if(t==3)return l+="!bg-[#515151] text-white"},ve=t=>{var b,U;const l=(b=V.value)==null?void 0:b.kaigoSoftwares;return((U=l==null?void 0:l.find(q=>q.id==t))==null?void 0:U.name)??""};return(t,l)=>{const b=xt,U=oe,q=kt,_e=Pe,he=$e,ge=Te;return d(),S("div",wt,[e("div",Ct,[e("div",{class:"flex"},[e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:pe},"編集"),e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:N},"削除")]),_(b,{class:"mr-10",length:s(E),"onUpdate:pagination":n},null,8,["length"])]),e("div",$t,[e("div",Dt,[e("table",Et,[e("thead",At,[e("tr",null,[e("th",null,[e("span",It,[s(a)===0||s(a)===1?(d(),z(U,{key:0,id:"select-all",class:"bg-white flex items-center justify-center mx-4 text-black border border-gray-300",checked:s(a)===0,"onUpdate:checked":o},null,8,["checked"])):I("",!0),s(a)===2?(d(),z(q,{key:1,onClick:L})):I("",!0)])]),(d(),S(Q,null,W(x,(f,O)=>e("th",{class:"py-3",key:O,style:Ne({width:f.width})},[e("span",{class:se(["flex items-center justify-center px-4 text-black border-white cursor-pointer",O<x.length-1?"border-r-2":""]),onClick:te=>C(f)},[H(y(f.label)+" ",1),s(c)&&s(c).split(":")[1]==("SORT"in t?t.SORT:s(F)).ASC&&f.key==s(c).split(":")[0]?(d(),z(s(ke),{key:0,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):I("",!0),s(c)&&s(c).split(":")[1]==("SORT"in t?t.SORT:s(F)).DESC&&f.key==s(c).split(":")[0]?(d(),z(s(we),{key:1,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):I("",!0)],10,Ut)],4)),64))])]),e("tbody",Mt,[s(i).length>0?(d(!0),S(Q,{key:0},W(s(i),(f,O)=>(d(),S("tr",{key:O,class:se([O<s(i).length-1?"border-b":"",fe(f.status)]),onDblclick:te=>me(f.id)},[e("td",Rt,[_(U,{id:"select-row-"+f.id,class:"m-auto bg-white flex items-center justify-center text-black border border-gray-300",checked:s(p).has(f.id),"onUpdate:checked":te=>A(f.id)},null,8,["id","checked","onUpdate:checked"])]),e("td",Lt,[e("span",null,y(f.companyName),1)]),e("td",Pt,[e("span",null,y(f.companyAddress),1)]),e("td",Tt,[e("span",null,y(f.phoneNumber),1)]),e("td",Vt,[e("span",null,y(f.frontPicFamilyName??"")+" "+y(f.frontPicGivenName??""),1)]),e("td",zt,[e("span",null,y(f.picFamilyName??"")+" "+y(f.picGivenName??""),1)]),e("td",Yt,[e("span",null,y(f.email??""),1)]),e("td",jt,[e("span",null,y(ve(f.kaigoSoftware)),1)]),e("td",Bt,[e("span",null,y(P(f.status)),1)]),e("td",Ot,[e("span",null,y(("formatDate"in t?t.formatDate:s(Ce))(f.createdAt,"YYYY-MM-DD")),1)])],42,Nt))),128)):I("",!0),s(i).length==0&&s(R)==!1?(d(),S("tr",Ft,[e("td",Gt,y(("MESSAGES"in t?t.MESSAGES:s(Re)).EMPTY),1)])):I("",!0)])])]),s(R)?(d(),z(_e,{key:0})):I("",!0)]),_(he,{class:"top-[5px]"}),_(ge,{"is-open":s($),onClose:l[0]||(l[0]=f=>$.value=!1),onUpdate:B},null,8,["is-open"])])}}}),Kt=Z(Ht,[["__scopeId","data-v-95208641"]]),Zt={class:"user-list px-4"},Jt={class:"body-content flex py-4 w-full gap-2"},ds=K({__name:"index",setup(Y){const D=m(1),k=m(30),v=m(""),u=m(""),r=m([]),w=m(""),h=m([]),g=m([]),x=m(!1),a=ee(),c=ue(),{toast:$}=re(),E=async()=>{let n=`page=${D.value}&pageSize=${k.value}`;v.value&&(n+=`&sort=${v.value}`),r.value.length&&r.value.forEach(C=>{n+=`&status=${C}`}),w.value&&(n+=`&keyword=${w.value}`),a.searchCompanies(n)},R=async({pageIndex:n,pageSize:C})=>{D.value=n,k.value=C,await E()},T=async n=>{v.value=n,await E()},V=async n=>{const[C,N]=n.split("/");u.value=`${C}-${N}-01`},p=async n=>{r.value=n,await E()},i=async n=>{w.value=n,await E()},o=({exceptionIds:n,checkedIds:C,selectedAll:N})=>{h.value=n,g.value=C,x.value=N},A=async()=>{P(0,"顧客情報ダウンロード用のリンクをメールで送信しました。")},L=async()=>{P(1,"利用状況ダウンロード用のリンクをメールで送信しました。")},P=async(n,C)=>{var B;if(!x.value&&g.value.length===0){j("顧客を選択してください","destructive");return}const N={exportType:n,targetYearMonth:u.value,status:r.value,keyword:w.value};await a.exportCompanyCustomer(N),(B=c.notify)!=null&&B.message||j(C,"default")},j=(n,C)=>{$({description:n,variant:C,duration:1e3})};return X(async()=>{await E()}),(n,C)=>{const N=tt,B=Kt;return d(),S("div",Zt,[C[0]||(C[0]=e("div",{class:"header flex items-center h-[40px] border-b border-b-[#e2e2e2]"},[e("span",{class:"text-base font-bold"},"顧客管理")],-1)),_(N,{"onUpdate:changeDate":V,"onUpdate:changeStatus":p,onSearchCompany:i,onExportCustomer:A,onExportStatusCompany:L}),e("div",Jt,[_(B,{class:"w-full","onUpdate:pagination":R,"onUpdate:sort":T,onGetCompanies:E,onSelectRow:o})])])}}});export{ds as default};
