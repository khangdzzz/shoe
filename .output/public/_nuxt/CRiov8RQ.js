import{a as ye,_ as xe}from"./D2vXzg64.js";import{_ as ie}from"./CyoNQLQd.js";import{_ as ce}from"./CdP55Q2D.js";import{g as Se,C as ue,j as be,V as Ce,S as ke,A as we,a as $e,_ as De}from"./Bt0tQ-Lh.js";import{C as Ee}from"./D5vXzQSD.js";import{m as K,r as p,J as H,g as Q,z as D,o as g,c as $,a as e,b as v,w as F,p as o,d as B,t as C,H as de,L as Ue,N as Ne,O as Pe,Q as Ie,v as G,x as A,R as Le,h as Me,D as X,E as Z,n as pe,y as ze,S as Ae,C as re,U as V,M as Re}from"./DT8mLZv2.js";import{_ as q}from"./DlAUqK2U.js";import{u as me}from"./B0Y37l_p.js";import{u as ee}from"./BHE2gwQM.js";import{L as le}from"./B96hvU8w.js";import{C as Te}from"./EahrPfw4.js";import{_ as Ye}from"./DLeSVN2Y.js";import{u as ge}from"./DYZ97-0e.js";import{_ as Oe}from"./BVRAvP8O.js";import{f as je}from"./DevxgbSN.js";import"./CPOD2jPJ.js";import"./CBRyS3R8.js";const Ve={class:"date-search flex items-center gap-3"},Fe={class:"flex items-center gap-2"},Be={class:"border border-gray-300 h-[30px] flex items-center justify-between px-4 bg-white rounded cursor-pointer"},Ge=K({__name:"date",emits:["update:selectedDate"],setup(P,{emit:S}){const h=S,n=()=>{const i=new Date,r=i.getFullYear(),m=i.getMonth()+1;return{year:r,month:m}},b=p(n()),l=p(n().year),a=p(""),c=()=>{const{year:i,month:r}=b.value;a.value=`${i}/${r.toString().padStart(2,"0")}`,h("update:selectedDate",a.value)},u=i=>{let{year:r,month:m}=b.value;m+=i,m>12?(m=1,r+=1):m<1&&(m=12,r-=1),y.value={year:r,month:m-1}};H(()=>{c()});const y=p({year:b.value.year,month:b.value.month-1});Q(y,()=>{b.value={year:y.value.year,month:y.value.month+1},l.value=y.value.year,c()});const k=D(()=>{const i=new Date,r=i.getFullYear(),m=i.getMonth();return l.value===r?{months:Array.from({length:12},(N,L)=>{const R=new Date(r,L);return L>m?Se(R):null}).filter(Boolean)}:{months:l.value>r?Array.from({length:12},(N,L)=>L):[]}});return(i,r)=>{const m=ce;return g(),$("div",Ve,[e("div",Fe,[v(m,{variant:"default",class:"bg-[#bfbfbf] text-black hover:bg-[#c4b3b3]","left-icon":"search",onClick:r[0]||(r[0]=N=>u(-1))},{default:F(()=>[v(o(ue),{class:"w-4 h-4"}),r[3]||(r[3]=B(" 前月 "))]),_:1}),v(o(Ce),{modelValue:o(y),"onUpdate:modelValue":r[1]||(r[1]=N=>de(y)?y.value=N:null),"month-picker":"","auto-apply":"","format-locale":o(be),format:"E",filters:o(k),onUpdateMonthYear:r[2]||(r[2]=N=>l.value=N.year)},{trigger:F(()=>[e("div",Be,[e("span",null,C(o(a)),1),v(o(Ee),{class:"w-4 h-4"})])]),_:1},8,["modelValue","format-locale","filters"])])])}}}),Ke=q(Ge,[["__scopeId","data-v-6268865c"]]),te=Ue("customerPageStore",()=>{const P=p({page:1,pageSize:30,sort:"",status:[],keyword:""}),S=Ne(),h=D(()=>S.getCurrentUserFromStorage()),n=D(()=>{var a;return`${(a=h.value)==null?void 0:a.id}_company_admin`});return{customerStorageCondition:P,setCustomerStorageCondition:a=>{const c=S.getLocalStorage(n.value);if(c){const u=JSON.parse(c);P.value={...u,...a}}else P.value={...P.value,...a};S.setLocalStorage(n.value,JSON.stringify(P.value))},getCustomerStorageCondition:()=>{const a=S.getLocalStorage(n.value);if(a){const c=JSON.parse(a);P.value={...P.value,...c}}return P.value}}}),Je={class:"search flex flex-col gap-8 min-h-[100px]"},He={class:"company flex max-sm:flex-col gap-5"},Qe={class:"relative items-center font-medium lg:w-[450px]"},qe={class:"absolute start-0 inset-y-0 flex items-center justify-center px-2"},We={class:"active flex gap-5"},Xe={class:"flex items-center gap-2"},Ze={class:"flex items-center gap-2"},et={class:"flex items-center gap-2"},tt={class:"actions flex max-sm:flex-col gap-5"},st={class:"flex gap-5 lg:w-[450px]"},ot={class:"flex gap-5"},at=K({__name:"index",emits:["update:changeDate","update:changeStatus","searchCompany","exportCustomer","exportStatusCompany"],setup(P,{emit:S}){const{redirectPage:h}=me(),n=ee(),b=te(),l=S,a=p(""),c=p([]),u=p(""),y=p(!1),k=D(()=>n.isLoadingExportCompany),i=D(()=>n.isLoadingExportStatusCompany),r=x=>{a.value=x,l("update:changeDate",a.value)},m=(x,t)=>{t?c.value.push(x):c.value=c.value.filter(f=>f!==x),l("update:changeStatus",c.value)},N=()=>{h("/customer/create-new-customer")},L=()=>{l("exportCustomer")},R=()=>{l("exportStatusCompany")},E=()=>{if(y.value){y.value=!1;return}l("searchCompany",u.value)},M=x=>{y.value=!0,x.target.blur(),l("searchCompany",u.value)},U=D(()=>b.customerStorageCondition);return Q(U,()=>{c.value=U.value.status,u.value=U.value.keyword}),(x,t)=>{const f=ye,w=ie,z=ce,I=Ke;return g(),$("div",Je,[e("div",He,[e("div",Qe,[v(f,{id:"search",type:"text",placeholder:"Search...",class:"pl-10 w-[70%]",modelValue:o(u),"onUpdate:modelValue":t[0]||(t[0]=T=>de(u)?u.value=T:null),onBlur:E,onKeydown:Pe(Ie(M,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),e("span",qe,[v(o(ke),{class:"w-4 h-4"})])]),e("div",We,[e("div",Xe,[v(w,{id:"normal",class:"bg-white",checked:o(c).includes(1),"onUpdate:checked":t[1]||(t[1]=T=>m(1,T))},null,8,["checked"]),t[4]||(t[4]=e("span",{for:"suspension",class:"flex text-xs flex-shrink-0"}," 利用中 ",-1))]),e("div",Ze,[v(w,{id:"terms",class:"bg-white",checked:o(c).includes(2),"onUpdate:checked":t[2]||(t[2]=T=>m(2,T))},null,8,["checked"]),t[5]||(t[5]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 停止中 ",-1))]),e("div",et,[v(w,{id:"temporary",class:"bg-white",checked:o(c).includes(3),"onUpdate:checked":t[3]||(t[3]=T=>m(3,T))},null,8,["checked"]),t[6]||(t[6]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 退会済 ",-1))])])]),e("div",tt,[e("div",st,[v(z,{variant:"export","left-icon":"search",class:"cursor-pointer",onClick:N},{default:F(()=>t[7]||(t[7]=[B(" 新規顧客追加 ")])),_:1}),v(z,{variant:"export","left-icon":"search",onClick:L},{default:F(()=>[o(k)?(g(),G(o(le),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):A("",!0),t[8]||(t[8]=B(" 顧客情報出力 "))]),_:1})]),e("div",ot,[v(I,{"onUpdate:selectedDate":r}),v(z,{variant:"export","left-icon":"search",onClick:R},{default:F(()=>[o(i)?(g(),G(o(le),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):A("",!0),t[9]||(t[9]=B(" 利用状況出力 "))]),_:1})])])])}}}),nt=q(at,[["__scopeId","data-v-665761e3"]]),rt={class:"pagination max-w-[350px]"},lt={class:"flex items-center gap-5 justify-between"},it={class:"flex items-center gap-2"},ct={class:"text-center"},ut={key:0,class:"dropdown-content absolute left-0 mt-1 w-full bg-white shadow-xl z-12"},dt=["onClick"],pt={class:"flex items-center gap-2"},mt={key:0,class:"from"},gt={key:1},vt={key:2},ft={key:3,class:"to"},_t={key:4},ht={key:5,class:"total"},yt={class:"flex items-center gap-2"},xt=["disabled"],St=["disabled"],bt=K({__name:"pagination",props:{length:{type:Number,default:100},pagination:{type:Object,default:()=>({pageIndex:1,pageSize:30})}},emits:["update:pagination"],setup(P,{emit:S}){const h=P,{length:n}=Le(h),b=D(()=>h.pagination),l=p(b.value.pageSize.toString()),a=p(b.value.pageIndex),c=[30,100,200],u=p(!1),y=p(null);Q(b,()=>{l.value=b.value.pageSize.toString(),a.value=b.value.pageIndex});const k=S,i=D(()=>Math.ceil(n.value/parseInt(l.value))),r=D(()=>n.value===0?0:(a.value-1)*parseInt(l.value)+1),m=D(()=>{if(n.value===0)return 0;const U=a.value*parseInt(l.value);return U>n.value?n.value:U}),N=U=>{l.value=U.toString(),a.value=1,u.value=!1,k("update:pagination",{pageIndex:a.value,pageSize:U})},L=()=>{a.value>1&&(a.value--,k("update:pagination",{pageIndex:a.value,pageSize:parseInt(l.value)}))},R=()=>{a.value<i.value&&(a.value++,k("update:pagination",{pageIndex:a.value,pageSize:parseInt(l.value)}))},E=D(()=>a.value>=i.value||n.value===0),M=U=>{y.value&&!y.value.contains(U.target)&&(u.value=!1)};return H(()=>{window.addEventListener("click",M)}),Me(()=>{window.removeEventListener("click",M)}),(U,x)=>(g(),$("div",rt,[e("div",lt,[e("div",it,[x[2]||(x[2]=e("span",null,"表示数:",-1)),e("div",{class:"relative",ref_key:"dropdownRef",ref:y},[e("button",{onClick:x[0]||(x[0]=t=>u.value=!u.value),class:"w-[60px] flex justify-between items-center px-2 py-1"},[e("span",ct,C(l.value),1),x[1]||(x[1]=e("div",{class:"w-0 h-0 border-l-[5px] border-r-[5px] border-t-[5px] border-transparent border-t-gray-500 hover:border-t-gray-700"},null,-1))]),u.value?(g(),$("div",ut,[e("ul",null,[(g(),$(X,null,Z(c,t=>e("li",{key:t,onClick:f=>N(t),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},C(t),9,dt)),64))])])):A("",!0)],512),e("div",pt,[o(n)>0?(g(),$("span",mt,C(r.value),1)):(g(),$("span",gt,"0")),o(n)>0?(g(),$("span",vt,"-")):A("",!0),o(n)>0?(g(),$("span",ft,C(m.value)+" 件",1)):(g(),$("span",_t,"件")),o(n)>0?(g(),$("span",ht,"(全"+C(o(n))+"件)",1)):A("",!0)])]),e("div",yt,[e("button",{onClick:L,disabled:a.value===1||o(n)===0,class:"disabled:opacity-50"},[v(o(ue),{class:"w-4 h-4"})],8,xt),e("button",{onClick:R,disabled:E.value,class:"disabled:opacity-50"},[v(o(Te),{class:"w-4 h-4"})],8,St)])])]))}}),Ct=q(bt,[["__scopeId","data-v-3b5cf6f5"]]),kt={class:"user-container flex flex-col gap-2 overflow-hidden"},wt={class:"actions flex justify-between items-center"},$t={class:"w-full flex flex-col relative border-l border-r"},Dt={class:"table-container overflow-auto border-b"},Et={class:"w-full table-fixed"},Ut={class:"bg-[#afeeee] sticky top-0 z-10"},Nt=["onClick"],Pt={class:""},It=["onDblclick"],Lt={class:"pr-[1px]"},Mt={class:"row-sticky px-[5px] truncate"},zt={class:"row-sticky px-[5px] truncate"},At={class:"px-[5px]"},Rt={class:"px-[5px] truncate"},Tt={class:"px-[5px] truncate"},Yt={class:"px-[5px]"},Ot={class:"px-[5px] text-center"},jt={class:"px-[5px] text-center"},Vt={class:"px-[5px] text-center"},Ft={key:1},Bt={colspan:"9",class:"text-center py-4 text-[#5566da]"},Gt=K({__name:"index",emits:["update:pagination","update:sort","getCompanies"],setup(P,{emit:S}){const h=ee(),n=pe(),b=ze(),l=te(),{redirectPage:a}=me(),{toast:c}=ge(),u=S,y={1:"利用中",2:"停止中",3:"退会済"},k=[{label:"法人名",width:"10%",isSort:!0,key:"companyName"},{label:"所在地",width:"15%",isSort:!0,key:"companyAddress"},{label:"電話番号",width:"9%",isSort:!0,key:"phoneNumber"},{label:"代表者",width:"9%",isSort:!0,key:"frontPicFamilyName"},{label:"担当者",width:"9%",isSort:!0,key:"picFamilyName"},{label:"メールアドレス",width:"15%",isSort:!0,key:"email"},{label:"介護ソフト",width:"10%",isSort:!0,key:"kaigoSoftware"},{label:"ステータス",width:"9%",isSort:!0,key:"status"},{label:"開始日",width:"9%",isSort:!0,key:"createdAt"}],i=p(""),r=p(!1),m=D(()=>{var s;return((s=h.companyUsers)==null?void 0:s.totalRecord)??0}),N=D(()=>h.isLoadCompanyCustomers),L=D(()=>n.notify),R=D(()=>b.masterData),E=p(new Set),M=D(()=>{var s;return E.value=new Set,((s=h.companyUsers)==null?void 0:s.results)??[]}),U=s=>{E.value.has(s)?E.value.delete(s):E.value.add(s)},x=s=>s?y[s]:s=0,t=({pageIndex:s,pageSize:_})=>{u("update:pagination",{pageIndex:s,pageSize:_})},f=s=>{if(!s.isSort)return;const[_,Y]=i.value.split(":"),O=_===s.key?Y===V.ASC?V.DESC:"":V.ASC;i.value=O?`${s.key}:${O}`:"",u("update:sort",i.value)},w=()=>{if(E.value.size==0){J("destructive","削除する会社を選択してください");return}r.value=!0},z=async()=>{var _;n.clearNotify(),h.isLoadCompanyCustomers=!0,r.value=!1;const s=Array.from(E.value);if(await h.bulkDelete(s),(_=L.value)!=null&&_.message){h.isLoadCompanyCustomers=!1;return}u("getCompanies"),setTimeout(()=>{J("default","選択した顧客を削除しました。")},1e3)},I=()=>{if(E.value.size==0){J("destructive","編集する会社を選択してください");return}if(E.value.size>1){J("destructive","編集する会社を1つだけ選択してください");return}a(`/customer/detail/${E.value.values().next().value}`)},T=s=>{a(`/customer/detail/${s}`)},J=(s,_)=>{c({description:_,variant:s,duration:1e3})},ve=s=>{let _="bg-white dark:bg-gray-800 h-10 hover:cursor-pointer ";if(!s||s==1)return _+="hover:bg-[#afe7ee47]";if(s==2)return _+="!bg-[#feffce]";if(s==3)return _+="!bg-[#515151] text-white"},fe=s=>{var Y,O;const _=(Y=R.value)==null?void 0:Y.kaigoSoftwares;return((O=_==null?void 0:_.find(W=>W.id==s))==null?void 0:O.name)??""},se=p({pageIndex:1,pageSize:30}),oe=D(()=>l.customerStorageCondition);Q(oe,()=>{ae(oe.value)}),H(()=>{const s=l.getCustomerStorageCondition();ae(s)});const ae=s=>{se.value={pageIndex:s.page,pageSize:s.pageSize},i.value=s.sort};return(s,_)=>{const Y=Ct,O=ie,W=Ye,_e=De,he=Oe;return g(),$("div",kt,[e("div",wt,[e("div",{class:"flex"},[e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:I},"編集"),e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:w},"削除")]),v(Y,{class:"mr-10",length:o(m),"onUpdate:pagination":t,pagination:o(se)},null,8,["length","pagination"])]),e("div",$t,[e("div",Dt,[e("table",Et,[e("thead",Ut,[e("tr",null,[_[1]||(_[1]=e("th",{class:"py-3"},[e("span",{class:"flex items-center justify-center px-4 text-black border-white cursor-pointer border-r-2 p-[9px]"})],-1)),(g(),$(X,null,Z(k,(d,j)=>e("th",{class:"py-3",key:j,style:Ae({width:d.width})},[e("span",{class:re(["flex items-center justify-center px-4 text-black border-white cursor-pointer",j<k.length-1?"border-r-2":""]),onClick:ne=>f(d)},[B(C(d.label)+" ",1),o(i)&&o(i).split(":")[1]==("SORT"in s?s.SORT:o(V)).ASC&&d.key==o(i).split(":")[0]?(g(),G(o(we),{key:0,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):A("",!0),o(i)&&o(i).split(":")[1]==("SORT"in s?s.SORT:o(V)).DESC&&d.key==o(i).split(":")[0]?(g(),G(o($e),{key:1,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):A("",!0)],10,Nt)],4)),64))])]),e("tbody",Pt,[o(M).length>0?(g(!0),$(X,{key:0},Z(o(M),(d,j)=>(g(),$("tr",{key:j,class:re([j<o(M).length-1?"border-b":"",ve(d.status)]),onDblclick:ne=>T(d.id)},[e("td",Lt,[v(O,{id:"select-row-"+d.id,class:"m-auto bg-white flex items-center justify-center text-black border border-gray-300",checked:o(E).has(d.id),"onUpdate:checked":ne=>U(d.id)},null,8,["id","checked","onUpdate:checked"])]),e("td",Mt,[e("span",null,C(d.companyName),1)]),e("td",zt,[e("span",null,C(d.companyAddress),1)]),e("td",At,[e("span",null,C(d.phoneNumber),1)]),e("td",Rt,[e("span",null,C(d.frontPicFamilyName??"")+" "+C(d.frontPicGivenName??""),1)]),e("td",Tt,[e("span",null,C(d.picFamilyName??"")+" "+C(d.picGivenName??""),1)]),e("td",Yt,[e("span",null,C(d.email??""),1)]),e("td",Ot,[e("span",null,C(fe(d.kaigoSoftware)),1)]),e("td",jt,[e("span",null,C(x(d.status)),1)]),e("td",Vt,[e("span",null,C(("formatDate"in s?s.formatDate:o(je))(d.createdAt,"YYYY-MM-DD")),1)])],42,It))),128)):A("",!0),o(M).length==0&&o(N)==!1?(g(),$("tr",Ft,[e("td",Bt,C(("MESSAGES"in s?s.MESSAGES:o(Re)).EMPTY),1)])):A("",!0)])])]),o(N)?(g(),G(W,{key:0})):A("",!0)]),v(_e,{class:"top-[5px]"}),v(he,{"is-open":o(r),onClose:_[0]||(_[0]=d=>r.value=!1),onUpdate:z},null,8,["is-open"])])}}}),Kt=q(Gt,[["__scopeId","data-v-14e07b0e"]]),Jt={class:"user-list px-4"},Ht={class:"relative header flex items-center h-[40px] border-b border-b-[#e2e2e2]"},Qt={class:"body-content flex py-4 w-full gap-2"},ms=K({__name:"index",setup(P){const S=p(1),h=p(30),n=p(""),b=p(""),l=p([]),a=p(""),c=ee();pe();const u=te(),{toast:y}=ge(),k=async()=>{const t=new URLSearchParams;t.append("page",S.value.toString()),t.append("pageSize",h.value.toString()),n.value&&t.append("sort",n.value),l.value.length&&l.value.forEach(w=>{t.append("status",w)}),a.value&&t.append("keyword",a.value);const f={page:S.value,pageSize:h.value,sort:n.value,status:l.value,keyword:a.value};u.setCustomerStorageCondition(f),await c.searchCompanies(t.toString())},i=async({pageIndex:t,pageSize:f})=>{S.value=t,h.value=f,await k()},r=async t=>{n.value=t,await k()},m=async t=>{const[f,w]=t.split("/");b.value=`${f}-${w}-01`},N=async t=>{l.value=t,S.value=1,await k()},L=async t=>{a.value=t,S.value=1,await k()},R=async()=>{M(0)},E=async()=>{M(1)},M=async t=>{const f={exportType:t,targetYearMonth:b.value},w=await c.exportCompanyCustomer(f),{downloadUrl:z,fileName:I}=w||{};if(!z||!I){x("データのエクスポートに失敗","destructive");return}await U(z,I),c.resetLoadingExport()},U=async(t,f)=>{try{const w=await fetch(t);if(!w.ok){x("データのエクスポートに失敗","destructive");return}const z=await w.blob(),I=document.createElement("a");I.href=URL.createObjectURL(z),I.download=f,document.body.appendChild(I),I.click(),document.body.removeChild(I)}catch{x("データのエクスポートに失敗","destructive")}},x=(t,f)=>{y({description:t,variant:f,duration:1e3})};return H(async()=>{const t=u.getCustomerStorageCondition();t&&(S.value=t.page,h.value=t.pageSize,n.value=t.sort,l.value=t.status,a.value=t.keyword),await k()}),(t,f)=>{const w=xe,z=nt,I=Kt;return g(),$("div",Jt,[e("div",Ht,[f[0]||(f[0]=e("span",{class:"text-base font-bold"},"顧客管理",-1)),v(w,{"class-custom":"absolute z-10 bg-[#ccc] w-[100%] top-[40px]  py-[11px]",type:"custom"})]),v(z,{"onUpdate:changeDate":m,"onUpdate:changeStatus":N,onSearchCompany:L,onExportCustomer:R,onExportStatusCompany:E}),e("div",Qt,[v(I,{class:"w-full","onUpdate:pagination":i,"onUpdate:sort":r,onGetCompanies:k})])])}}});export{ms as default};
