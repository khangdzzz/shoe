import{L as W,_ as fe}from"./f6BEByEl.js";import{_ as ee}from"./ChCsTFIl.js";import{_ as te}from"./B8s3fEPn.js";import{C as se,j as _e,V as he,S as ge,u as ae,A as xe,a as ye,f as be,_ as Se}from"./DPf9_sB-.js";import{C as ke}from"./D_CO2gNT.js";import{m as F,r as p,J as oe,g as ne,o as i,c as b,a as e,b as _,w as O,p as t,d as G,t as x,H as le,A as R,K as Ce,v as V,x as E,L as we,h as $e,E as J,G as q,n as re,N as De,D as X,S as B,M as Ae}from"./D6_zQaNs.js";import{_ as H}from"./DlAUqK2U.js";import{u as ce}from"./D31FMoHZ.js";import{u as Q}from"./DZqH5ETY.js";import{C as Ne}from"./wbxa2PJS.js";import{_ as Ee}from"./D71NqtWf.js";import{_ as Ie}from"./zAQd8lMy.js";import"./vmPt7QVW.js";import"./ZwHaNMWH.js";const Ue={class:"date-search flex items-center gap-3"},Le={class:"flex items-center gap-2"},Me={class:"border border-gray-300 h-[30px] flex items-center justify-between px-4 bg-white rounded cursor-pointer"},Re=F({__name:"date",emits:["update:selectedDate"],setup(z,{emit:D}){const C=D,c=p((()=>{const n=new Date,o=n.getFullYear(),d=n.getMonth()+1;return{year:o,month:d}})()),l=p(""),g=()=>{const{year:n,month:o}=c.value;l.value=`${n}/${o.toString().padStart(2,"0")}`,C("update:selectedDate",l.value)},y=n=>{let{year:o,month:d}=c.value;d+=n,d>12?(d=1,o+=1):d<1&&(d=12,o-=1),h.value={year:o,month:d-1}};oe(()=>{g()});const h=p({year:c.value.year,month:c.value.month-1});return ne(h,()=>{c.value={year:h.value.year,month:h.value.month+1},g()}),(n,o)=>{const d=te;return i(),b("div",Ue,[e("div",Le,[_(d,{variant:"default",class:"bg-[#bfbfbf] text-black hover:bg-[#c4b3b3]","left-icon":"search",onClick:o[0]||(o[0]=U=>y(-1))},{default:O(()=>[_(t(se),{class:"w-4 h-4"}),o[2]||(o[2]=G(" 前月 "))]),_:1}),_(t(he),{modelValue:t(h),"onUpdate:modelValue":o[1]||(o[1]=U=>le(h)?h.value=U:null),"month-picker":"","auto-apply":"","format-locale":t(_e),format:"E"},{trigger:O(()=>[e("div",Me,[e("span",null,x(t(l)),1),_(t(ke),{class:"w-4 h-4"})])]),_:1},8,["modelValue","format-locale"])])])}}}),Pe=H(Re,[["__scopeId","data-v-0df9fc12"]]),Te={class:"search flex flex-col gap-8 min-h-[100px]"},Ve={class:"company flex max-sm:flex-col gap-5"},ze={class:"relative items-center font-medium lg:w-[450px]"},Ye={class:"absolute start-0 inset-y-0 flex items-center justify-center px-2"},je={class:"active flex gap-5"},Be={class:"flex items-center gap-2"},Oe={class:"flex items-center gap-2"},Ge={class:"flex items-center gap-2"},Fe={class:"actions flex max-sm:flex-col gap-5"},He={class:"flex gap-5 lg:w-[450px]"},Ke={class:"flex gap-5"},Ze=F({__name:"index",emits:["update:changeDate","update:changeStatus","searchCompanyName","exportCustomer","exportStatusCompany"],setup(z,{emit:D}){const{redirectPage:C}=ce(),m=Q(),c=D,l=p(""),g=p([]),y=p(""),h=R(()=>m.isLoadingExportCompany),n=R(()=>m.isLoadingExportStatusCompany),o=r=>{l.value=r,c("update:changeDate",l.value)},d=(r,a)=>{a?g.value.push(r):g.value=g.value.filter(I=>I!==r),c("update:changeStatus",g.value)},U=()=>{C("/customer/create-new-customer")},A=()=>{c("exportCustomer")},T=()=>{c("exportStatusCompany")};return(r,a)=>{const I=fe,S=ee,w=te,L=Pe;return i(),b("div",Te,[e("div",Ve,[e("div",ze,[_(I,{id:"search",type:"text",placeholder:"Search...",class:"pl-10 w-[70%]",modelValue:t(y),"onUpdate:modelValue":a[0]||(a[0]=$=>le(y)?y.value=$:null),onBlur:a[1]||(a[1]=$=>c("searchCompanyName",t(y))),onKeydown:a[2]||(a[2]=Ce($=>c("searchCompanyName",t(y)),["enter"]))},null,8,["modelValue"]),e("span",Ye,[_(t(ge),{class:"w-4 h-4"})])]),e("div",je,[e("div",Be,[_(S,{id:"normal",class:"bg-white","onUpdate:checked":a[3]||(a[3]=$=>d(1,$))}),a[6]||(a[6]=e("span",{for:"suspension",class:"flex text-xs flex-shrink-0"}," 利用中 ",-1))]),e("div",Oe,[_(S,{id:"terms",class:"bg-white","onUpdate:checked":a[4]||(a[4]=$=>d(2,$))}),a[7]||(a[7]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 停止中 ",-1))]),e("div",Ge,[_(S,{id:"temporary",class:"bg-white","onUpdate:checked":a[5]||(a[5]=$=>d(3,$))}),a[8]||(a[8]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 退会済 ",-1))])])]),e("div",Fe,[e("div",He,[_(w,{variant:"export","left-icon":"search",class:"cursor-pointer",onClick:U},{default:O(()=>a[9]||(a[9]=[G(" 新規顧客追加 ")])),_:1}),_(w,{variant:"export","left-icon":"search",onClick:A},{default:O(()=>[t(h)?(i(),V(t(W),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):E("",!0),a[10]||(a[10]=G(" 顧客情報出力 "))]),_:1})]),e("div",Ke,[_(L,{"onUpdate:selectedDate":o}),_(w,{variant:"export","left-icon":"search",onClick:T},{default:O(()=>[t(n)?(i(),V(t(W),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):E("",!0),a[11]||(a[11]=G(" 利用状況出力 "))]),_:1})])])])}}}),Je=H(Ze,[["__scopeId","data-v-84f1edd0"]]),qe={class:"pagination max-w-[350px]"},Qe={class:"flex items-center gap-5 justify-between"},We={class:"flex items-center gap-2"},Xe={class:"text-center"},et={key:0,class:"dropdown-content absolute left-0 mt-1 w-full bg-white shadow-xl z-12"},tt=["onClick"],st={class:"flex items-center gap-2"},at={key:0,class:"from"},ot={key:1},nt={key:2},lt={key:3,class:"to"},rt={key:4},ct={key:5,class:"total"},it={class:"flex items-center gap-2"},dt=["disabled"],ut=["disabled"],pt=F({__name:"pagination",props:{length:{type:Number,default:100}},emits:["update:pagination"],setup(z,{emit:D}){const C=z,{length:m}=we(C),c=p("30"),l=p(1),g=[30,100,200],y=p(!1),h=p(null),n=D,o=R(()=>Math.ceil(m.value/parseInt(c.value))),d=R(()=>m.value===0?0:(l.value-1)*parseInt(c.value)+1),U=R(()=>{if(m.value===0)return 0;const S=l.value*parseInt(c.value);return S>m.value?m.value:S}),A=S=>{c.value=S.toString(),l.value=1,y.value=!1,n("update:pagination",{pageIndex:l.value,pageSize:S})},T=()=>{l.value>1&&(l.value--,n("update:pagination",{pageIndex:l.value,pageSize:parseInt(c.value)}))},r=()=>{l.value<o.value&&(l.value++,n("update:pagination",{pageIndex:l.value,pageSize:parseInt(c.value)}))},a=R(()=>l.value>=o.value||m.value===0),I=S=>{h.value&&!h.value.contains(S.target)&&(y.value=!1)};return oe(()=>{window.addEventListener("click",I)}),$e(()=>{window.removeEventListener("click",I)}),(S,w)=>(i(),b("div",qe,[e("div",Qe,[e("div",We,[w[2]||(w[2]=e("span",null,"表示数:",-1)),e("div",{class:"relative",ref_key:"dropdownRef",ref:h},[e("button",{onClick:w[0]||(w[0]=L=>y.value=!y.value),class:"w-[60px] flex justify-between items-center px-2 py-1"},[e("span",Xe,x(c.value),1),w[1]||(w[1]=e("div",{class:"w-0 h-0 border-l-[5px] border-r-[5px] border-t-[5px] border-transparent border-t-gray-500 hover:border-t-gray-700"},null,-1))]),y.value?(i(),b("div",et,[e("ul",null,[(i(),b(J,null,q(g,L=>e("li",{key:L,onClick:$=>A(L),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},x(L),9,tt)),64))])])):E("",!0)],512),e("div",st,[t(m)>0?(i(),b("span",at,x(d.value),1)):(i(),b("span",ot,"0")),t(m)>0?(i(),b("span",nt,"-")):E("",!0),t(m)>0?(i(),b("span",lt,x(U.value)+" 件",1)):(i(),b("span",rt,"件")),t(m)>0?(i(),b("span",ct,"(全"+x(t(m))+"件)",1)):E("",!0)])]),e("div",it,[e("button",{onClick:T,disabled:l.value===1||t(m)===0,class:"disabled:opacity-50"},[_(t(se),{class:"w-4 h-4"})],8,dt),e("button",{onClick:r,disabled:a.value,class:"disabled:opacity-50"},[_(t(Ne),{class:"w-4 h-4"})],8,ut)])])]))}}),mt=H(pt,[["__scopeId","data-v-f974aacb"]]),vt={},ft={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function _t(z,D){return i(),b("svg",ft,D[0]||(D[0]=[e("path",{d:"M15.8333 2.5H4.16667C3.25 2.5 2.5 3.25 2.5 4.16667V15.8333C2.5 16.75 3.25 17.5 4.16667 17.5H15.8333C16.75 17.5 17.5 16.75 17.5 15.8333V4.16667C17.5 3.25 16.75 2.5 15.8333 2.5ZM14.1667 10.8333H5.83333V9.16667H14.1667V10.8333Z",fill:"#343DD6"},null,-1)]))}const ht=H(vt,[["render",_t]]),gt={class:"user-container flex flex-col gap-2 overflow-hidden"},xt={class:"actions flex justify-between items-center"},yt={class:"w-full flex flex-col relative border-l border-r"},bt={class:"table-container overflow-auto border-b"},St={class:"w-full table-fixed"},kt={class:"bg-[#afeeee] sticky top-0 z-10"},Ct={class:"flex items-center justify-center px-4 py-[1px] text-black border-white border-r-2"},wt=["onClick"],$t={class:""},Dt={class:"border-r border-[#52525200]"},At={class:"row-sticky px-[5px]"},Nt={class:"row-sticky px-[5px]"},Et={class:"px-[5px]"},It={class:"px-[5px]"},Ut={class:"px-[5px]"},Lt={class:"px-[5px]"},Mt={class:"px-[5px] text-center"},Rt={class:"px-[5px] text-center"},Pt={class:"px-[5px] text-center"},Tt={key:1},Vt={colspan:"9",class:"text-center py-4 text-[#5566da]"},zt=F({__name:"index",emits:["update:pagination","update:sort","getCompanies","selectRow"],setup(z,{emit:D}){const C=Q(),m=re(),{redirectPage:c}=ce(),{toast:l}=ae(),g=D,y={1:"利用中",2:"停止中",3:"退会済み"},h=[{label:"法人名",width:"10%",isSort:!0,key:"companyName"},{label:"所在地",width:"15%",isSort:!0,key:"companyAddress"},{label:"電話番号",width:"9%",isSort:!0,key:"phoneNumber"},{label:"代表者",width:"9%",isSort:!0,key:"frontPicFamilyName"},{label:"担当者",width:"9%",isSort:!0,key:"picFamilyName"},{label:"メールアドレス",width:"15%",isSort:!0,key:"email"},{label:"介護ソフト",width:"10%",isSort:!0,key:"kaigoSoftware"},{label:"ステータス",width:"9%",isSort:!0,key:"status"},{label:"開始日",width:"9%",isSort:!0,key:"createdAt"}],n=p(1),o=p(""),d=p(!1),U=R(()=>{var s;return((s=C.companyUsers)==null?void 0:s.totalRecord)??0}),A=R(()=>C.isLoadCompanyCustomers),T=R(()=>m.notify),r=p(new Set),a=R(()=>{var s;return r.value=new Set,((s=C.companyUsers)==null?void 0:s.results)??[]}),I=s=>{s?(n.value=0,r.value=new Set(a.value.map(f=>f.id))):(n.value=1,r.value.clear())},S=s=>{r.value.has(s)?r.value.delete(s):r.value.add(s);const f=a.value.length,N=r.value.size;N===0?n.value=1:N===f?n.value=0:n.value===0&&N<f&&(n.value=2)},w=()=>{I(!1)};ne(r,()=>{const s=[],f=[],N=$();N?a.value.forEach(P=>{r.value.has(P.id)||s.push(P.id)}):f.push(...r.value),g("selectRow",{exceptionIds:s,checkedIds:f,selectedAll:N})},{deep:!0});const L=s=>s?y[s]:s=0,$=()=>n.value===0||n.value===2,K=({pageIndex:s,pageSize:f})=>{g("update:pagination",{pageIndex:s,pageSize:f})},Z=s=>{if(!s.isSort)return;const[f,N]=o.value.split(":"),P=f===s.key?N===B.ASC?B.DESC:"":B.ASC;o.value=P?`${s.key}:${P}`:"",g("update:sort",o.value)},u=()=>{if(r.value.size==0){Y("destructive","削除する会社を選択してください");return}d.value=!0},k=async()=>{var N;C.isLoadCompanyCustomers=!0,d.value=!1;const s=Array.from(r.value);if(await C.bulkDelete(s),(N=T.value)!=null&&N.message){C.isLoadCompanyCustomers=!1;return}Y("default","会社を削除しました"),g("getCompanies")},M=()=>{if(r.value.size==0){Y("destructive","編集する会社を選択してください");return}if(r.value.size>1){Y("destructive","編集する会社を1つだけ選択してください");return}c(`/customer/detail/${r.value.values().next().value}`)},Y=(s,f)=>{l({description:f,variant:s,duration:1e3})},ie=s=>{let f="bg-white dark:bg-gray-800 h-10 hover:cursor-pointer ";if(!s||s==1)return f+="hover:bg-[#afe7ee47]";if(s==2)return f+="!bg-[#feffce]";if(s==3)return f+="!bg-[#515151] text-white"};return(s,f)=>{const N=mt,P=ee,de=ht,ue=Ee,pe=Se,me=Ie;return i(),b("div",gt,[e("div",xt,[e("div",{class:"flex"},[e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:M},"編集"),e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:u},"削除")]),_(N,{class:"mr-10",length:t(U),"onUpdate:pagination":K},null,8,["length"])]),e("div",yt,[e("div",bt,[e("table",St,[e("thead",kt,[e("tr",null,[e("th",null,[e("span",Ct,[t(n)===0||t(n)===1?(i(),V(P,{key:0,id:"select-all",class:"bg-white flex items-center justify-center mx-4 text-black border border-gray-300",checked:t(n)===0,"onUpdate:checked":I},null,8,["checked"])):E("",!0),t(n)===2?(i(),V(de,{key:1,onClick:w})):E("",!0)])]),(i(),b(J,null,q(h,(v,j)=>e("th",{class:"py-3",key:j,style:De({width:v.width})},[e("span",{class:X(["flex items-center justify-center px-4 text-black border-white cursor-pointer",j<h.length-1?"border-r-2":""]),onClick:ve=>Z(v)},[G(x(v.label)+" ",1),t(o)&&t(o).split(":")[1]==("SORT"in s?s.SORT:t(B)).ASC&&v.key==t(o).split(":")[0]?(i(),V(t(xe),{key:0,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):E("",!0),t(o)&&t(o).split(":")[1]==("SORT"in s?s.SORT:t(B)).DESC&&v.key==t(o).split(":")[0]?(i(),V(t(ye),{key:1,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):E("",!0)],10,wt)],4)),64))])]),e("tbody",$t,[t(a).length>0?(i(!0),b(J,{key:0},q(t(a),(v,j)=>(i(),b("tr",{key:j,class:X([j<t(a).length-1?"border-b":"",ie(v.status)])},[e("td",Dt,[_(P,{id:"select-row-"+v.id,class:"m-auto bg-white flex items-center justify-center text-black border border-gray-300",checked:t(r).has(v.id),"onUpdate:checked":ve=>S(v.id)},null,8,["id","checked","onUpdate:checked"])]),e("td",At,[e("span",null,x(v.companyName),1)]),e("td",Nt,[e("span",null,x(v.companyAddress),1)]),e("td",Et,[e("span",null,x(v.phoneNumber),1)]),e("td",It,[e("span",null,x(v.frontPicFamilyName??"")+" "+x(v.frontPicGivenName??""),1)]),e("td",Ut,[e("span",null,x(v.picFamilyName??"")+" "+x(v.picGivenName??""),1)]),e("td",Lt,[e("span",null,x(v.email??""),1)]),e("td",Mt,[e("span",null,x(v.kaigoSoftware),1)]),e("td",Rt,[e("span",null,x(L(v.status)),1)]),e("td",Pt,[e("span",null,x(("formatDate"in s?s.formatDate:t(be))(v.createdAt,"YYYY-MM-DD")),1)])],2))),128)):E("",!0),t(a).length==0&&t(A)==!1?(i(),b("tr",Tt,[e("td",Vt,x(("MESSAGES"in s?s.MESSAGES:t(Ae)).EMPTY),1)])):E("",!0)])])]),t(A)?(i(),V(ue,{key:0})):E("",!0)]),_(pe,{class:"top-[5px]"}),_(me,{"is-open":t(d),onClose:f[0]||(f[0]=v=>d.value=!1),onUpdate:k},null,8,["is-open"])])}}}),Yt=H(zt,[["__scopeId","data-v-0216d8d3"]]),jt={class:"user-list px-4"},Bt={class:"body-content flex py-4 w-full gap-2"},as=F({__name:"index",setup(z){const D=p(1),C=p(30),m=p(""),c=p(""),l=p([]),g=p(""),y=p([]),h=p([]),n=p(!1),o=Q(),d=re(),{toast:U}=ae(),A=async()=>{let u=`page=${D.value}&pageSize=${C.value}`;m.value&&(u+=`&sort=${m.value}`),l.value.length&&l.value.forEach(k=>{u+=`&status=${k}`}),g.value&&(u+=`&keyword=${g.value}`),o.searchCompanies(u)},T=async({pageIndex:u,pageSize:k})=>{D.value=u,C.value=k,await A()},r=async u=>{m.value=u,await A()},a=async u=>{const[k,M]=u.split("/");c.value=`${k}-${M}-01`,await A()},I=async u=>{l.value=u,await A()},S=async u=>{g.value=u,await A()},w=({exceptionIds:u,checkedIds:k,selectedAll:M})=>{y.value=u,h.value=k,n.value=M},L=async()=>{K(0)},$=async()=>{K(1)},K=async u=>{var M;if(!n.value&&h.value.length===0){Z("顧客を選択してください","destructive");return}const k={exportType:u,checkedListId:h.value,exceptionListId:y.value,isSelectedAll:n.value,targetYearMonth:c.value,status:l.value,companyName:g.value};await o.exportCompanyCustomer(k),(M=d.notify)!=null&&M.message||Z("顧客情報をエクスポートしました","default")},Z=(u,k)=>{U({description:u,variant:k,duration:1e3})};return(u,k)=>{const M=Je,Y=Yt;return i(),b("div",jt,[k[0]||(k[0]=e("div",{class:"header flex items-center h-[40px] border-b border-b-[#e2e2e2]"},[e("span",{class:"text-base font-bold"},"顧客管理")],-1)),_(M,{"onUpdate:changeDate":a,"onUpdate:changeStatus":I,onSearchCompanyName:S,onExportCustomer:L,onExportStatusCompany:$}),e("div",Bt,[_(Y,{class:"w-full","onUpdate:pagination":T,"onUpdate:sort":r,onGetCompanies:A,onSelectRow:w})])])}}});export{as as default};
