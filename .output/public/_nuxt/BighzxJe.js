import{_ as xe}from"./cGtsHAop.js";import{_ as te}from"./ytGDqJMF.js";import{_ as se}from"./CNVSGk8U.js";import{C as ae,j as ye,V as be,S as ke,u as oe,A as Se,a as Ce,f as we,_ as $e}from"./8-wozSc7.js";import{C as De}from"./BT7EZ4QW.js";import{m as F,r as v,J as q,g as ne,o as d,c as k,a as e,b as _,w as B,p as s,d as O,t as y,H as le,A as I,K as Ee,L as Ae,v as R,x as E,N as Ue,h as Ie,E as Z,G as J,n as re,y as Me,O as Ne,D as X,S as j,M as Pe}from"./DGxLQE2y.js";import{_ as G}from"./DlAUqK2U.js";import{u as ce}from"./BOYK3-p7.js";import{u as Q}from"./Wp4KOlhB.js";import{L as ee}from"./CDNfbZ-T.js";import{C as Te}from"./Y3_nnGHR.js";import{_ as Ve}from"./Hyrx3tvk.js";import{_ as Le}from"./BmeuplRd.js";import"./CsnMo2br.js";import"./Cwo5f0gK.js";const Re={class:"date-search flex items-center gap-3"},ze={class:"flex items-center gap-2"},Ye={class:"border border-gray-300 h-[30px] flex items-center justify-between px-4 bg-white rounded cursor-pointer"},je=F({__name:"date",emits:["update:selectedDate"],setup(z,{emit:D}){const S=D,u=v((()=>{const b=new Date,a=b.getFullYear(),i=b.getMonth()+1;return{year:a,month:i}})()),l=v(""),C=()=>{const{year:b,month:a}=u.value;l.value=`${b}/${a.toString().padStart(2,"0")}`,S("update:selectedDate",l.value)},h=b=>{let{year:a,month:i}=u.value;i+=b,i>12?(i=1,a+=1):i<1&&(i=12,a-=1),g.value={year:a,month:i-1}};q(()=>{C()});const g=v({year:u.value.year,month:u.value.month-1});return ne(g,()=>{u.value={year:g.value.year,month:g.value.month+1},C()}),(b,a)=>{const i=se;return d(),k("div",Re,[e("div",ze,[_(i,{variant:"default",class:"bg-[#bfbfbf] text-black hover:bg-[#c4b3b3]","left-icon":"search",onClick:a[0]||(a[0]=$=>h(-1))},{default:B(()=>[_(s(ae),{class:"w-4 h-4"}),a[2]||(a[2]=O(" 前月 "))]),_:1}),_(s(be),{modelValue:s(g),"onUpdate:modelValue":a[1]||(a[1]=$=>le(g)?g.value=$:null),"month-picker":"","auto-apply":"","format-locale":s(ye),format:"E"},{trigger:B(()=>[e("div",Ye,[e("span",null,y(s(l)),1),_(s(De),{class:"w-4 h-4"})])]),_:1},8,["modelValue","format-locale"])])])}}}),Be=G(je,[["__scopeId","data-v-0df9fc12"]]),Oe={class:"search flex flex-col gap-8 min-h-[100px]"},Fe={class:"company flex max-sm:flex-col gap-5"},Ge={class:"relative items-center font-medium lg:w-[450px]"},He={class:"absolute start-0 inset-y-0 flex items-center justify-center px-2"},Ke={class:"active flex gap-5"},Ze={class:"flex items-center gap-2"},Je={class:"flex items-center gap-2"},qe={class:"flex items-center gap-2"},Qe={class:"actions flex max-sm:flex-col gap-5"},We={class:"flex gap-5 lg:w-[450px]"},Xe={class:"flex gap-5"},et=F({__name:"index",emits:["update:changeDate","update:changeStatus","searchCompany","exportCustomer","exportStatusCompany"],setup(z,{emit:D}){const{redirectPage:S}=ce(),f=Q(),u=D,l=v(""),C=v([]),h=v(""),g=v(!1),b=I(()=>f.isLoadingExportCompany),a=I(()=>f.isLoadingExportStatusCompany),i=r=>{l.value=r,u("update:changeDate",l.value)},$=(r,o)=>{o?C.value.push(r):C.value=C.value.filter(n=>n!==r),u("update:changeStatus",C.value)},T=()=>{S("/customer/create-new-customer")},N=()=>{u("exportCustomer")},V=()=>{u("exportStatusCompany")},L=()=>{if(g.value){g.value=!1;return}u("searchCompany",h.value)},p=r=>{g.value=!0,r.target.blur(),u("searchCompany",h.value)};return(r,o)=>{const n=xe,x=te,A=se,P=Be;return d(),k("div",Oe,[e("div",Fe,[e("div",Ge,[_(n,{id:"search",type:"text",placeholder:"Search...",class:"pl-10 w-[70%]",modelValue:s(h),"onUpdate:modelValue":o[0]||(o[0]=M=>le(h)?h.value=M:null),onBlur:L,onKeydown:Ee(Ae(p,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),e("span",He,[_(s(ke),{class:"w-4 h-4"})])]),e("div",Ke,[e("div",Ze,[_(x,{id:"normal",class:"bg-white","onUpdate:checked":o[1]||(o[1]=M=>$(1,M))}),o[4]||(o[4]=e("span",{for:"suspension",class:"flex text-xs flex-shrink-0"}," 利用中 ",-1))]),e("div",Je,[_(x,{id:"terms",class:"bg-white","onUpdate:checked":o[2]||(o[2]=M=>$(2,M))}),o[5]||(o[5]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 停止中 ",-1))]),e("div",qe,[_(x,{id:"temporary",class:"bg-white","onUpdate:checked":o[3]||(o[3]=M=>$(3,M))}),o[6]||(o[6]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 退会済 ",-1))])])]),e("div",Qe,[e("div",We,[_(A,{variant:"export","left-icon":"search",class:"cursor-pointer",onClick:T},{default:B(()=>o[7]||(o[7]=[O(" 新規顧客追加 ")])),_:1}),_(A,{variant:"export","left-icon":"search",onClick:N},{default:B(()=>[s(b)?(d(),R(s(ee),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):E("",!0),o[8]||(o[8]=O(" 顧客情報出力 "))]),_:1})]),e("div",Xe,[_(P,{"onUpdate:selectedDate":i}),_(A,{variant:"export","left-icon":"search",onClick:V},{default:B(()=>[s(a)?(d(),R(s(ee),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):E("",!0),o[9]||(o[9]=O(" 利用状況出力 "))]),_:1})])])])}}}),tt=G(et,[["__scopeId","data-v-48888dc7"]]),st={class:"pagination max-w-[350px]"},at={class:"flex items-center gap-5 justify-between"},ot={class:"flex items-center gap-2"},nt={class:"text-center"},lt={key:0,class:"dropdown-content absolute left-0 mt-1 w-full bg-white shadow-xl z-12"},rt=["onClick"],ct={class:"flex items-center gap-2"},it={key:0,class:"from"},ut={key:1},dt={key:2},pt={key:3,class:"to"},mt={key:4},ft={key:5,class:"total"},_t={class:"flex items-center gap-2"},vt=["disabled"],ht=["disabled"],gt=F({__name:"pagination",props:{length:{type:Number,default:100}},emits:["update:pagination"],setup(z,{emit:D}){const S=z,{length:f}=Ue(S),u=v("30"),l=v(1),C=[30,100,200],h=v(!1),g=v(null),b=D,a=I(()=>Math.ceil(f.value/parseInt(u.value))),i=I(()=>f.value===0?0:(l.value-1)*parseInt(u.value)+1),$=I(()=>{if(f.value===0)return 0;const r=l.value*parseInt(u.value);return r>f.value?f.value:r}),T=r=>{u.value=r.toString(),l.value=1,h.value=!1,b("update:pagination",{pageIndex:l.value,pageSize:r})},N=()=>{l.value>1&&(l.value--,b("update:pagination",{pageIndex:l.value,pageSize:parseInt(u.value)}))},V=()=>{l.value<a.value&&(l.value++,b("update:pagination",{pageIndex:l.value,pageSize:parseInt(u.value)}))},L=I(()=>l.value>=a.value||f.value===0),p=r=>{g.value&&!g.value.contains(r.target)&&(h.value=!1)};return q(()=>{window.addEventListener("click",p)}),Ie(()=>{window.removeEventListener("click",p)}),(r,o)=>(d(),k("div",st,[e("div",at,[e("div",ot,[o[2]||(o[2]=e("span",null,"表示数:",-1)),e("div",{class:"relative",ref_key:"dropdownRef",ref:g},[e("button",{onClick:o[0]||(o[0]=n=>h.value=!h.value),class:"w-[60px] flex justify-between items-center px-2 py-1"},[e("span",nt,y(u.value),1),o[1]||(o[1]=e("div",{class:"w-0 h-0 border-l-[5px] border-r-[5px] border-t-[5px] border-transparent border-t-gray-500 hover:border-t-gray-700"},null,-1))]),h.value?(d(),k("div",lt,[e("ul",null,[(d(),k(Z,null,J(C,n=>e("li",{key:n,onClick:x=>T(n),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},y(n),9,rt)),64))])])):E("",!0)],512),e("div",ct,[s(f)>0?(d(),k("span",it,y(i.value),1)):(d(),k("span",ut,"0")),s(f)>0?(d(),k("span",dt,"-")):E("",!0),s(f)>0?(d(),k("span",pt,y($.value)+" 件",1)):(d(),k("span",mt,"件")),s(f)>0?(d(),k("span",ft,"(全"+y(s(f))+"件)",1)):E("",!0)])]),e("div",_t,[e("button",{onClick:N,disabled:l.value===1||s(f)===0,class:"disabled:opacity-50"},[_(s(ae),{class:"w-4 h-4"})],8,vt),e("button",{onClick:V,disabled:L.value,class:"disabled:opacity-50"},[_(s(Te),{class:"w-4 h-4"})],8,ht)])])]))}}),xt=G(gt,[["__scopeId","data-v-f974aacb"]]),yt={},bt={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function kt(z,D){return d(),k("svg",bt,D[0]||(D[0]=[e("path",{d:"M15.8333 2.5H4.16667C3.25 2.5 2.5 3.25 2.5 4.16667V15.8333C2.5 16.75 3.25 17.5 4.16667 17.5H15.8333C16.75 17.5 17.5 16.75 17.5 15.8333V4.16667C17.5 3.25 16.75 2.5 15.8333 2.5ZM14.1667 10.8333H5.83333V9.16667H14.1667V10.8333Z",fill:"#343DD6"},null,-1)]))}const St=G(yt,[["render",kt]]),Ct={class:"user-container flex flex-col gap-2 overflow-hidden"},wt={class:"actions flex justify-between items-center"},$t={class:"w-full flex flex-col relative border-l border-r"},Dt={class:"table-container overflow-auto border-b"},Et={class:"w-full table-fixed"},At={class:"bg-[#afeeee] sticky top-0 z-10"},Ut={class:"flex items-center justify-center px-4 py-[1px] text-black border-white border-r-2"},It=["onClick"],Mt={class:""},Nt=["onDblclick"],Pt={class:"pr-[1px]"},Tt={class:"row-sticky px-[5px]"},Vt={class:"row-sticky px-[5px]"},Lt={class:"px-[5px]"},Rt={class:"px-[5px]"},zt={class:"px-[5px]"},Yt={class:"px-[5px]"},jt={class:"px-[5px] text-center"},Bt={class:"px-[5px] text-center"},Ot={class:"px-[5px] text-center"},Ft={key:1},Gt={colspan:"9",class:"text-center py-4 text-[#5566da]"},Ht=F({__name:"index",emits:["update:pagination","update:sort","getCompanies"],setup(z,{emit:D}){const S=Q(),f=re(),u=Me(),{redirectPage:l}=ce(),{toast:C}=oe(),h=D,g={1:"利用中",2:"停止中",3:"退会済"},b=[{label:"法人名",width:"10%",isSort:!0,key:"companyName"},{label:"所在地",width:"15%",isSort:!0,key:"companyAddress"},{label:"電話番号",width:"9%",isSort:!0,key:"phoneNumber"},{label:"代表者",width:"9%",isSort:!0,key:"frontPicFamilyName"},{label:"担当者",width:"9%",isSort:!0,key:"picFamilyName"},{label:"メールアドレス",width:"15%",isSort:!0,key:"email"},{label:"介護ソフト",width:"10%",isSort:!0,key:"kaigoSoftware"},{label:"ステータス",width:"9%",isSort:!0,key:"status"},{label:"開始日",width:"9%",isSort:!0,key:"createdAt"}],a=v(1),i=v(""),$=v(!1),T=I(()=>{var t;return((t=S.companyUsers)==null?void 0:t.totalRecord)??0}),N=I(()=>S.isLoadCompanyCustomers),V=I(()=>f.notify),L=I(()=>u.masterData),p=v(new Set),r=I(()=>{var t,c;return p.value=new Set,a.value==0&&(p.value=new Set((t=S.companyUsers)==null?void 0:t.results.map(w=>w.id))),((c=S.companyUsers)==null?void 0:c.results)??[]}),o=t=>{t?(a.value=0,p.value=new Set(r.value.map(c=>c.id))):(a.value=1,p.value.clear())},n=t=>{p.value.has(t)?p.value.delete(t):p.value.add(t);const c=r.value.length,w=p.value.size;w===0?a.value=1:w===c?a.value=0:a.value===0&&w<c&&(a.value=2)},x=()=>{o(!1)};ne(p,()=>{const t=[],c=[];P()?r.value.forEach(U=>{p.value.has(U.id)||t.push(U.id)}):c.push(...p.value)},{deep:!0});const A=t=>t?g[t]:t=0,P=()=>a.value===0||a.value===2,M=({pageIndex:t,pageSize:c})=>{h("update:pagination",{pageIndex:t,pageSize:c})},ie=t=>{if(!t.isSort)return;const[c,w]=i.value.split(":"),U=c===t.key?w===j.ASC?j.DESC:"":j.ASC;i.value=U?`${t.key}:${U}`:"",h("update:sort",i.value)},ue=()=>{if(p.value.size==0){H("destructive","削除する会社を選択してください");return}$.value=!0},de=async()=>{var w;S.isLoadCompanyCustomers=!0,$.value=!1;const t=Array.from(p.value);if(await S.bulkDelete(t),(w=V.value)!=null&&w.message){S.isLoadCompanyCustomers=!1;return}H("default","会社を削除しました"),h("getCompanies")},pe=()=>{if(p.value.size==0){H("destructive","編集する会社を選択してください");return}if(p.value.size>1){H("destructive","編集する会社を1つだけ選択してください");return}l(`/customer/detail/${p.value.values().next().value}`)},me=t=>{l(`/customer/detail/${t}`)},H=(t,c)=>{C({description:c,variant:t,duration:1e3})},fe=t=>{let c="bg-white dark:bg-gray-800 h-10 hover:cursor-pointer ";if(!t||t==1)return c+="hover:bg-[#afe7ee47]";if(t==2)return c+="!bg-[#feffce]";if(t==3)return c+="!bg-[#515151] text-white"},_e=t=>{var w,U;const c=(w=L.value)==null?void 0:w.kaigoSoftwares;return((U=c==null?void 0:c.find(K=>K.id==t))==null?void 0:U.name)??""};return(t,c)=>{const w=xt,U=te,K=St,ve=Ve,he=$e,ge=Le;return d(),k("div",Ct,[e("div",wt,[e("div",{class:"flex"},[e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:pe},"編集"),e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:ue},"削除")]),_(w,{class:"mr-10",length:s(T),"onUpdate:pagination":M},null,8,["length"])]),e("div",$t,[e("div",Dt,[e("table",Et,[e("thead",At,[e("tr",null,[e("th",null,[e("span",Ut,[s(a)===0||s(a)===1?(d(),R(U,{key:0,id:"select-all",class:"bg-white flex items-center justify-center mx-4 text-black border border-gray-300",checked:s(a)===0,"onUpdate:checked":o},null,8,["checked"])):E("",!0),s(a)===2?(d(),R(K,{key:1,onClick:x})):E("",!0)])]),(d(),k(Z,null,J(b,(m,Y)=>e("th",{class:"py-3",key:Y,style:Ne({width:m.width})},[e("span",{class:X(["flex items-center justify-center px-4 text-black border-white cursor-pointer",Y<b.length-1?"border-r-2":""]),onClick:W=>ie(m)},[O(y(m.label)+" ",1),s(i)&&s(i).split(":")[1]==("SORT"in t?t.SORT:s(j)).ASC&&m.key==s(i).split(":")[0]?(d(),R(s(Se),{key:0,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):E("",!0),s(i)&&s(i).split(":")[1]==("SORT"in t?t.SORT:s(j)).DESC&&m.key==s(i).split(":")[0]?(d(),R(s(Ce),{key:1,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):E("",!0)],10,It)],4)),64))])]),e("tbody",Mt,[s(r).length>0?(d(!0),k(Z,{key:0},J(s(r),(m,Y)=>(d(),k("tr",{key:Y,class:X([Y<s(r).length-1?"border-b":"",fe(m.status)]),onDblclick:W=>me(m.id)},[e("td",Pt,[_(U,{id:"select-row-"+m.id,class:"m-auto bg-white flex items-center justify-center text-black border border-gray-300",checked:s(p).has(m.id),"onUpdate:checked":W=>n(m.id)},null,8,["id","checked","onUpdate:checked"])]),e("td",Tt,[e("span",null,y(m.companyName),1)]),e("td",Vt,[e("span",null,y(m.companyAddress),1)]),e("td",Lt,[e("span",null,y(m.phoneNumber),1)]),e("td",Rt,[e("span",null,y(m.frontPicFamilyName??"")+" "+y(m.frontPicGivenName??""),1)]),e("td",zt,[e("span",null,y(m.picFamilyName??"")+" "+y(m.picGivenName??""),1)]),e("td",Yt,[e("span",null,y(m.email??""),1)]),e("td",jt,[e("span",null,y(_e(m.kaigoSoftware)),1)]),e("td",Bt,[e("span",null,y(A(m.status)),1)]),e("td",Ot,[e("span",null,y(("formatDate"in t?t.formatDate:s(we))(m.createdAt,"YYYY-MM-DD")),1)])],42,Nt))),128)):E("",!0),s(r).length==0&&s(N)==!1?(d(),k("tr",Ft,[e("td",Gt,y(("MESSAGES"in t?t.MESSAGES:s(Pe)).EMPTY),1)])):E("",!0)])])]),s(N)?(d(),R(ve,{key:0})):E("",!0)]),_(he,{class:"top-[5px]"}),_(ge,{"is-open":s($),onClose:c[0]||(c[0]=m=>$.value=!1),onUpdate:de},null,8,["is-open"])])}}}),Kt=G(Ht,[["__scopeId","data-v-93b896d8"]]),Zt={class:"user-list px-4"},Jt={class:"body-content flex py-4 w-full gap-2"},ds=F({__name:"index",setup(z){const D=v(1),S=v(30),f=v(""),u=v(""),l=v([]),C=v(""),h=Q(),g=re(),{toast:b}=oe(),a=async()=>{let n=`page=${D.value}&pageSize=${S.value}`;f.value&&(n+=`&sort=${f.value}`),l.value.length&&l.value.forEach(x=>{n+=`&status=${x}`}),C.value&&(n+=`&keyword=${C.value}`),h.searchCompanies(n)},i=async({pageIndex:n,pageSize:x})=>{D.value=n,S.value=x,await a()},$=async n=>{f.value=n,await a()},T=async n=>{const[x,A]=n.split("/");u.value=`${x}-${A}-01`},N=async n=>{l.value=n,await a()},V=async n=>{C.value=n,await a()},L=async()=>{r(0,"顧客情報ダウンロード用のリンクをメールで送信しました。")},p=async()=>{r(1,"利用状況ダウンロード用のリンクをメールで送信しました。")},r=async(n,x)=>{var P;const A={exportType:n,targetYearMonth:u.value,status:l.value,keyword:C.value};await h.exportCompanyCustomer(A),(P=g.notify)!=null&&P.message||o(x,"default")},o=(n,x)=>{b({description:n,variant:x,duration:1e3})};return q(async()=>{await a()}),(n,x)=>{const A=tt,P=Kt;return d(),k("div",Zt,[x[0]||(x[0]=e("div",{class:"header flex items-center h-[40px] border-b border-b-[#e2e2e2]"},[e("span",{class:"text-base font-bold"},"顧客管理")],-1)),_(A,{"onUpdate:changeDate":T,"onUpdate:changeStatus":N,onSearchCompany:V,onExportCustomer:L,onExportStatusCompany:p}),e("div",Jt,[_(P,{class:"w-full","onUpdate:pagination":i,"onUpdate:sort":$,onGetCompanies:a})])])}}});export{ds as default};
