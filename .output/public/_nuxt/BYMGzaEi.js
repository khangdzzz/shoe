import{_ as xe}from"./rNsDV_hC.js";import{_ as oe}from"./B-dFcVXP.js";import{_ as ne}from"./CAGg0RHQ.js";import{C as le,j as ye,V as be,S as Se,u as re,A as ke,a as we,f as Ce,_ as $e}from"./GpYhusoG.js";import{C as De}from"./ySqNkGWT.js";import{m as K,r as p,J as X,g as ce,o as d,c as b,a as e,b as g,w as G,p as s,d as H,t as y,H as ie,A as M,K as Ee,L as Ae,v as z,x as I,N as Ie,h as Ue,E as Q,G as W,n as ue,y as Me,O as Ne,D as se,S as F,M as Le}from"./Bgnwh5r4.js";import{_ as Z}from"./DlAUqK2U.js";import{u as de}from"./C8Ve72Sq.js";import{u as ee}from"./Cpee-8z-.js";import{L as ae}from"./BQRBkTT0.js";import{C as Re}from"./CWiifFEW.js";import{_ as Pe}from"./CaOAIKb2.js";import{_ as Te}from"./CdgSLvXf.js";import"./D0psvkxm.js";import"./DiscgxsV.js";const Ve={class:"date-search flex items-center gap-3"},ze={class:"flex items-center gap-2"},Ye={class:"border border-gray-300 h-[30px] flex items-center justify-between px-4 bg-white rounded cursor-pointer"},je=K({__name:"date",emits:["update:selectedDate"],setup(Y,{emit:D}){const C=D,i=p((()=>{const x=new Date,a=x.getFullYear(),r=x.getMonth()+1;return{year:a,month:r}})()),l=p(""),S=()=>{const{year:x,month:a}=i.value;l.value=`${x}/${a.toString().padStart(2,"0")}`,C("update:selectedDate",l.value)},_=x=>{let{year:a,month:r}=i.value;r+=x,r>12?(r=1,a+=1):r<1&&(r=12,a-=1),h.value={year:a,month:r-1}};X(()=>{S()});const h=p({year:i.value.year,month:i.value.month-1});return ce(h,()=>{i.value={year:h.value.year,month:h.value.month+1},S()}),(x,a)=>{const r=ne;return d(),b("div",Ve,[e("div",ze,[g(r,{variant:"default",class:"bg-[#bfbfbf] text-black hover:bg-[#c4b3b3]","left-icon":"search",onClick:a[0]||(a[0]=$=>_(-1))},{default:G(()=>[g(s(le),{class:"w-4 h-4"}),a[2]||(a[2]=H(" 前月 "))]),_:1}),g(s(be),{modelValue:s(h),"onUpdate:modelValue":a[1]||(a[1]=$=>ie(h)?h.value=$:null),"month-picker":"","auto-apply":"","format-locale":s(ye),format:"E"},{trigger:G(()=>[e("div",Ye,[e("span",null,y(s(l)),1),g(s(De),{class:"w-4 h-4"})])]),_:1},8,["modelValue","format-locale"])])])}}}),Be=Z(je,[["__scopeId","data-v-0df9fc12"]]),Oe={class:"search flex flex-col gap-8 min-h-[100px]"},Fe={class:"company flex max-sm:flex-col gap-5"},Ge={class:"relative items-center font-medium lg:w-[450px]"},He={class:"absolute start-0 inset-y-0 flex items-center justify-center px-2"},Ke={class:"active flex gap-5"},Ze={class:"flex items-center gap-2"},Je={class:"flex items-center gap-2"},qe={class:"flex items-center gap-2"},Qe={class:"actions flex max-sm:flex-col gap-5"},We={class:"flex gap-5 lg:w-[450px]"},Xe={class:"flex gap-5"},et=K({__name:"index",emits:["update:changeDate","update:changeStatus","searchCompany","exportCustomer","exportStatusCompany"],setup(Y,{emit:D}){const{redirectPage:C}=de(),f=ee(),i=D,l=p(""),S=p([]),_=p(""),h=p(!1),x=M(()=>f.isLoadingExportCompany),a=M(()=>f.isLoadingExportStatusCompany),r=c=>{l.value=c,i("update:changeDate",l.value)},$=(c,o)=>{o?S.value.push(c):S.value=S.value.filter(A=>A!==c),i("update:changeStatus",S.value)},E=()=>{C("/customer/create-new-customer")},L=()=>{i("exportCustomer")},T=()=>{i("exportStatusCompany")},V=()=>{if(h.value){h.value=!1;return}i("searchCompany",_.value)},m=c=>{h.value=!0,c.target.blur(),i("searchCompany",_.value)};return(c,o)=>{const A=xe,R=oe,P=ne,j=Be;return d(),b("div",Oe,[e("div",Fe,[e("div",Ge,[g(A,{id:"search",type:"text",placeholder:"Search...",class:"pl-10 w-[70%]",modelValue:s(_),"onUpdate:modelValue":o[0]||(o[0]=n=>ie(_)?_.value=n:null),onBlur:V,onKeydown:Ee(Ae(m,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),e("span",He,[g(s(Se),{class:"w-4 h-4"})])]),e("div",Ke,[e("div",Ze,[g(R,{id:"normal",class:"bg-white","onUpdate:checked":o[1]||(o[1]=n=>$(1,n))}),o[4]||(o[4]=e("span",{for:"suspension",class:"flex text-xs flex-shrink-0"}," 利用中 ",-1))]),e("div",Je,[g(R,{id:"terms",class:"bg-white","onUpdate:checked":o[2]||(o[2]=n=>$(2,n))}),o[5]||(o[5]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 停止中 ",-1))]),e("div",qe,[g(R,{id:"temporary",class:"bg-white","onUpdate:checked":o[3]||(o[3]=n=>$(3,n))}),o[6]||(o[6]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 退会済 ",-1))])])]),e("div",Qe,[e("div",We,[g(P,{variant:"export","left-icon":"search",class:"cursor-pointer",onClick:E},{default:G(()=>o[7]||(o[7]=[H(" 新規顧客追加 ")])),_:1}),g(P,{variant:"export","left-icon":"search",onClick:L},{default:G(()=>[s(x)?(d(),z(s(ae),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):I("",!0),o[8]||(o[8]=H(" 顧客情報出力 "))]),_:1})]),e("div",Xe,[g(j,{"onUpdate:selectedDate":r}),g(P,{variant:"export","left-icon":"search",onClick:T},{default:G(()=>[s(a)?(d(),z(s(ae),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):I("",!0),o[9]||(o[9]=H(" 利用状況出力 "))]),_:1})])])])}}}),tt=Z(et,[["__scopeId","data-v-48888dc7"]]),st={class:"pagination max-w-[350px]"},at={class:"flex items-center gap-5 justify-between"},ot={class:"flex items-center gap-2"},nt={class:"text-center"},lt={key:0,class:"dropdown-content absolute left-0 mt-1 w-full bg-white shadow-xl z-12"},rt=["onClick"],ct={class:"flex items-center gap-2"},it={key:0,class:"from"},ut={key:1},dt={key:2},pt={key:3,class:"to"},mt={key:4},vt={key:5,class:"total"},ft={class:"flex items-center gap-2"},_t=["disabled"],ht=["disabled"],gt=K({__name:"pagination",props:{length:{type:Number,default:100}},emits:["update:pagination"],setup(Y,{emit:D}){const C=Y,{length:f}=Ie(C),i=p("30"),l=p(1),S=[30,100,200],_=p(!1),h=p(null),x=D,a=M(()=>Math.ceil(f.value/parseInt(i.value))),r=M(()=>f.value===0?0:(l.value-1)*parseInt(i.value)+1),$=M(()=>{if(f.value===0)return 0;const c=l.value*parseInt(i.value);return c>f.value?f.value:c}),E=c=>{i.value=c.toString(),l.value=1,_.value=!1,x("update:pagination",{pageIndex:l.value,pageSize:c})},L=()=>{l.value>1&&(l.value--,x("update:pagination",{pageIndex:l.value,pageSize:parseInt(i.value)}))},T=()=>{l.value<a.value&&(l.value++,x("update:pagination",{pageIndex:l.value,pageSize:parseInt(i.value)}))},V=M(()=>l.value>=a.value||f.value===0),m=c=>{h.value&&!h.value.contains(c.target)&&(_.value=!1)};return X(()=>{window.addEventListener("click",m)}),Ue(()=>{window.removeEventListener("click",m)}),(c,o)=>(d(),b("div",st,[e("div",at,[e("div",ot,[o[2]||(o[2]=e("span",null,"表示数:",-1)),e("div",{class:"relative",ref_key:"dropdownRef",ref:h},[e("button",{onClick:o[0]||(o[0]=A=>_.value=!_.value),class:"w-[60px] flex justify-between items-center px-2 py-1"},[e("span",nt,y(i.value),1),o[1]||(o[1]=e("div",{class:"w-0 h-0 border-l-[5px] border-r-[5px] border-t-[5px] border-transparent border-t-gray-500 hover:border-t-gray-700"},null,-1))]),_.value?(d(),b("div",lt,[e("ul",null,[(d(),b(Q,null,W(S,A=>e("li",{key:A,onClick:R=>E(A),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},y(A),9,rt)),64))])])):I("",!0)],512),e("div",ct,[s(f)>0?(d(),b("span",it,y(r.value),1)):(d(),b("span",ut,"0")),s(f)>0?(d(),b("span",dt,"-")):I("",!0),s(f)>0?(d(),b("span",pt,y($.value)+" 件",1)):(d(),b("span",mt,"件")),s(f)>0?(d(),b("span",vt,"(全"+y(s(f))+"件)",1)):I("",!0)])]),e("div",ft,[e("button",{onClick:L,disabled:l.value===1||s(f)===0,class:"disabled:opacity-50"},[g(s(le),{class:"w-4 h-4"})],8,_t),e("button",{onClick:T,disabled:V.value,class:"disabled:opacity-50"},[g(s(Re),{class:"w-4 h-4"})],8,ht)])])]))}}),xt=Z(gt,[["__scopeId","data-v-f974aacb"]]),yt={},bt={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function St(Y,D){return d(),b("svg",bt,D[0]||(D[0]=[e("path",{d:"M15.8333 2.5H4.16667C3.25 2.5 2.5 3.25 2.5 4.16667V15.8333C2.5 16.75 3.25 17.5 4.16667 17.5H15.8333C16.75 17.5 17.5 16.75 17.5 15.8333V4.16667C17.5 3.25 16.75 2.5 15.8333 2.5ZM14.1667 10.8333H5.83333V9.16667H14.1667V10.8333Z",fill:"#343DD6"},null,-1)]))}const kt=Z(yt,[["render",St]]),wt={class:"user-container flex flex-col gap-2 overflow-hidden"},Ct={class:"actions flex justify-between items-center"},$t={class:"w-full flex flex-col relative border-l border-r"},Dt={class:"table-container overflow-auto border-b"},Et={class:"w-full table-fixed"},At={class:"bg-[#afeeee] sticky top-0 z-10"},It={class:"flex items-center justify-center px-4 py-[1px] text-black border-white border-r-2"},Ut=["onClick"],Mt={class:""},Nt=["onDblclick"],Lt={class:"pr-[1px]"},Rt={class:"row-sticky px-[5px]"},Pt={class:"row-sticky px-[5px]"},Tt={class:"px-[5px]"},Vt={class:"px-[5px]"},zt={class:"px-[5px]"},Yt={class:"px-[5px]"},jt={class:"px-[5px] text-center"},Bt={class:"px-[5px] text-center"},Ot={class:"px-[5px] text-center"},Ft={key:1},Gt={colspan:"9",class:"text-center py-4 text-[#5566da]"},Ht=K({__name:"index",emits:["update:pagination","update:sort","getCompanies","selectRow"],setup(Y,{emit:D}){const C=ee(),f=ue(),i=Me(),{redirectPage:l}=de(),{toast:S}=re(),_=D,h={1:"利用中",2:"停止中",3:"退会済"},x=[{label:"法人名",width:"10%",isSort:!0,key:"companyName"},{label:"所在地",width:"15%",isSort:!0,key:"companyAddress"},{label:"電話番号",width:"9%",isSort:!0,key:"phoneNumber"},{label:"代表者",width:"9%",isSort:!0,key:"frontPicFamilyName"},{label:"担当者",width:"9%",isSort:!0,key:"picFamilyName"},{label:"メールアドレス",width:"15%",isSort:!0,key:"email"},{label:"介護ソフト",width:"10%",isSort:!0,key:"kaigoSoftware"},{label:"ステータス",width:"9%",isSort:!0,key:"status"},{label:"開始日",width:"9%",isSort:!0,key:"createdAt"}],a=p(1),r=p(""),$=p(!1),E=M(()=>{var t;return((t=C.companyUsers)==null?void 0:t.totalRecord)??0}),L=M(()=>C.isLoadCompanyCustomers),T=M(()=>f.notify),V=M(()=>i.masterData),m=p(new Set),c=M(()=>{var t;return m.value=new Set,((t=C.companyUsers)==null?void 0:t.results)??[]}),o=t=>{t?(a.value=0,m.value=new Set(c.value.map(u=>u.id))):(a.value=1,m.value.clear())},A=t=>{m.value.has(t)?m.value.delete(t):m.value.add(t);const u=c.value.length,w=m.value.size;w===0?a.value=1:w===u?a.value=0:a.value===0&&w<u&&(a.value=2)},R=()=>{o(!1)};ce(m,()=>{const t=[],u=[],w=j();w?c.value.forEach(U=>{m.value.has(U.id)||t.push(U.id)}):u.push(...m.value),_("selectRow",{exceptionIds:t,checkedIds:u,selectedAll:w})},{deep:!0});const P=t=>t?h[t]:t=0,j=()=>a.value===0||a.value===2,n=({pageIndex:t,pageSize:u})=>{_("update:pagination",{pageIndex:t,pageSize:u})},k=t=>{if(!t.isSort)return;const[u,w]=r.value.split(":"),U=u===t.key?w===F.ASC?F.DESC:"":F.ASC;r.value=U?`${t.key}:${U}`:"",_("update:sort",r.value)},N=()=>{if(m.value.size==0){J("destructive","削除する会社を選択してください");return}$.value=!0},B=async()=>{var w;C.isLoadCompanyCustomers=!0,$.value=!1;const t=Array.from(m.value);if(await C.bulkDelete(t),(w=T.value)!=null&&w.message){C.isLoadCompanyCustomers=!1;return}J("default","会社を削除しました"),_("getCompanies")},pe=()=>{if(m.value.size==0){J("destructive","編集する会社を選択してください");return}if(m.value.size>1){J("destructive","編集する会社を1つだけ選択してください");return}l(`/customer/detail/${m.value.values().next().value}`)},me=t=>{l(`/customer/detail/${t}`)},J=(t,u)=>{S({description:u,variant:t,duration:1e3})},ve=t=>{let u="bg-white dark:bg-gray-800 h-10 hover:cursor-pointer ";if(!t||t==1)return u+="hover:bg-[#afe7ee47]";if(t==2)return u+="!bg-[#feffce]";if(t==3)return u+="!bg-[#515151] text-white"},fe=t=>{var w,U;const u=(w=V.value)==null?void 0:w.kaigoSoftwares;return((U=u==null?void 0:u.find(q=>q.id==t))==null?void 0:U.name)??""};return(t,u)=>{const w=xt,U=oe,q=kt,_e=Pe,he=$e,ge=Te;return d(),b("div",wt,[e("div",Ct,[e("div",{class:"flex"},[e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:pe},"編集"),e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:N},"削除")]),g(w,{class:"mr-10",length:s(E),"onUpdate:pagination":n},null,8,["length"])]),e("div",$t,[e("div",Dt,[e("table",Et,[e("thead",At,[e("tr",null,[e("th",null,[e("span",It,[s(a)===0||s(a)===1?(d(),z(U,{key:0,id:"select-all",class:"bg-white flex items-center justify-center mx-4 text-black border border-gray-300",checked:s(a)===0,"onUpdate:checked":o},null,8,["checked"])):I("",!0),s(a)===2?(d(),z(q,{key:1,onClick:R})):I("",!0)])]),(d(),b(Q,null,W(x,(v,O)=>e("th",{class:"py-3",key:O,style:Ne({width:v.width})},[e("span",{class:se(["flex items-center justify-center px-4 text-black border-white cursor-pointer",O<x.length-1?"border-r-2":""]),onClick:te=>k(v)},[H(y(v.label)+" ",1),s(r)&&s(r).split(":")[1]==("SORT"in t?t.SORT:s(F)).ASC&&v.key==s(r).split(":")[0]?(d(),z(s(ke),{key:0,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):I("",!0),s(r)&&s(r).split(":")[1]==("SORT"in t?t.SORT:s(F)).DESC&&v.key==s(r).split(":")[0]?(d(),z(s(we),{key:1,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):I("",!0)],10,Ut)],4)),64))])]),e("tbody",Mt,[s(c).length>0?(d(!0),b(Q,{key:0},W(s(c),(v,O)=>(d(),b("tr",{key:O,class:se([O<s(c).length-1?"border-b":"",ve(v.status)]),onDblclick:te=>me(v.id)},[e("td",Lt,[g(U,{id:"select-row-"+v.id,class:"m-auto bg-white flex items-center justify-center text-black border border-gray-300",checked:s(m).has(v.id),"onUpdate:checked":te=>A(v.id)},null,8,["id","checked","onUpdate:checked"])]),e("td",Rt,[e("span",null,y(v.companyName),1)]),e("td",Pt,[e("span",null,y(v.companyAddress),1)]),e("td",Tt,[e("span",null,y(v.phoneNumber),1)]),e("td",Vt,[e("span",null,y(v.frontPicFamilyName??"")+" "+y(v.frontPicGivenName??""),1)]),e("td",zt,[e("span",null,y(v.picFamilyName??"")+" "+y(v.picGivenName??""),1)]),e("td",Yt,[e("span",null,y(v.email??""),1)]),e("td",jt,[e("span",null,y(fe(v.kaigoSoftware)),1)]),e("td",Bt,[e("span",null,y(P(v.status)),1)]),e("td",Ot,[e("span",null,y(("formatDate"in t?t.formatDate:s(Ce))(v.createdAt,"YYYY-MM-DD")),1)])],42,Nt))),128)):I("",!0),s(c).length==0&&s(L)==!1?(d(),b("tr",Ft,[e("td",Gt,y(("MESSAGES"in t?t.MESSAGES:s(Le)).EMPTY),1)])):I("",!0)])])]),s(L)?(d(),z(_e,{key:0})):I("",!0)]),g(he,{class:"top-[5px]"}),g(ge,{"is-open":s($),onClose:u[0]||(u[0]=v=>$.value=!1),onUpdate:B},null,8,["is-open"])])}}}),Kt=Z(Ht,[["__scopeId","data-v-7d6a463c"]]),Zt={class:"user-list px-4"},Jt={class:"body-content flex py-4 w-full gap-2"},ds=K({__name:"index",setup(Y){const D=p(1),C=p(30),f=p(""),i=p(""),l=p([]),S=p(""),_=p([]),h=p([]),x=p(!1),a=ee(),r=ue(),{toast:$}=re(),E=async()=>{let n=`page=${D.value}&pageSize=${C.value}`;f.value&&(n+=`&sort=${f.value}`),l.value.length&&l.value.forEach(k=>{n+=`&status=${k}`}),S.value&&(n+=`&keyword=${S.value}`),a.searchCompanies(n)},L=async({pageIndex:n,pageSize:k})=>{D.value=n,C.value=k,await E()},T=async n=>{f.value=n,await E()},V=async n=>{const[k,N]=n.split("/");i.value=`${k}-${N}-01`},m=async n=>{l.value=n,await E()},c=async n=>{S.value=n,await E()},o=({exceptionIds:n,checkedIds:k,selectedAll:N})=>{_.value=n,h.value=k,x.value=N},A=async()=>{P(0,"顧客情報ダウンロード用のリンクをメールで送信しました。")},R=async()=>{P(1,"利用状況ダウンロード用のリンクをメールで送信しました。")},P=async(n,k)=>{var B;if(!x.value&&h.value.length===0){j("顧客を選択してください","destructive");return}const N={exportType:n,checkedListId:h.value,exceptionListId:_.value,isSelectedAll:x.value,targetYearMonth:i.value,status:l.value,keyword:S.value};await a.exportCompanyCustomer(N),(B=r.notify)!=null&&B.message||j(k,"default")},j=(n,k)=>{$({description:n,variant:k,duration:1e3})};return X(async()=>{await E()}),(n,k)=>{const N=tt,B=Kt;return d(),b("div",Zt,[k[0]||(k[0]=e("div",{class:"header flex items-center h-[40px] border-b border-b-[#e2e2e2]"},[e("span",{class:"text-base font-bold"},"顧客管理")],-1)),g(N,{"onUpdate:changeDate":V,"onUpdate:changeStatus":m,onSearchCompany:c,onExportCustomer:A,onExportStatusCompany:R}),e("div",Jt,[g(B,{class:"w-full","onUpdate:pagination":L,"onUpdate:sort":T,onGetCompanies:E,onSelectRow:o})])])}}});export{ds as default};
