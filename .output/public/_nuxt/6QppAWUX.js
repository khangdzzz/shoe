import{_ as ne}from"./D24PGUX0.js";import{_ as H}from"./BntOVt5z.js";import{_ as J}from"./BpSNmjdr.js";import{C as Q,j as oe,V as le,S as re,u as ce,A as ie,a as de,f as pe,_ as ue,b as me}from"./Ct2YWgj-.js";import{C as _e}from"./Bu0K1Ktv.js";import{m as L,r as m,z as W,g as he,o as _,c as g,a as e,b as d,w as j,q as n,d as z,t as f,A as X,B as fe,C as ve,D as S,h as ge,E,G as O,y as M,H as xe,I as K,n as ye,p as be,J as ke,K as q,S as V,x as B}from"./CjF18qdG.js";import{_ as Y}from"./DlAUqK2U.js";import{C as we}from"./Cc7bR3fz.js";import"./BsVX-5Vd.js";import"./uUJuMH8l.js";const Se={class:"date-search flex items-center gap-3"},$e={class:"flex items-center gap-2"},Ce={class:"border border-gray-300 h-[30px] flex items-center justify-between px-4 bg-white rounded cursor-pointer"},De=L({__name:"date",emits:["update:selectedDate"],setup($,{emit:y}){const h=y,r=m((()=>{const t=new Date,l=t.getFullYear(),p=t.getMonth()+1;return{year:l,month:p}})()),a=m(""),v=()=>{const{year:t,month:l}=r.value;a.value=`${t}/${l.toString().padStart(2,"0")}`,h("update:selectedDate",a.value)},x=t=>{let{year:l,month:p}=r.value;p+=t,p>12?(p=1,l+=1):p<1&&(p=12,l-=1),c.value={year:l,month:p-1}};W(()=>{v()});const c=m({year:r.value.year,month:r.value.month-1});return he(c,()=>{r.value={year:c.value.year,month:c.value.month+1},v()}),(t,l)=>{const p=J;return _(),g("div",Se,[e("div",$e,[d(p,{variant:"default",class:"bg-[#bfbfbf] text-black hover:bg-[#c4b3b3]","left-icon":"search",onClick:l[0]||(l[0]=k=>x(-1))},{default:j(()=>[d(n(Q),{class:"w-4 h-4"}),l[2]||(l[2]=z(" 前月 "))]),_:1}),d(n(le),{modelValue:n(c),"onUpdate:modelValue":l[1]||(l[1]=k=>X(c)?c.value=k:null),"month-picker":"","auto-apply":"","format-locale":n(oe),format:"E"},{trigger:j(()=>[e("div",Ce,[e("span",null,f(n(a)),1),d(n(_e),{class:"w-4 h-4"})])]),_:1},8,["modelValue","format-locale"])])])}}}),Ae=Y(De,[["__scopeId","data-v-0df9fc12"]]),Ne={class:"search flex flex-col gap-8 min-h-[100px]"},Ue={class:"company flex max-sm:flex-col gap-5"},Ie={class:"relative items-center font-medium lg:w-[450px]"},Re={class:"absolute start-0 inset-y-0 flex items-center justify-center px-2"},Te={class:"active flex gap-5"},Me={class:"flex items-center gap-2"},Pe={class:"flex items-center gap-2"},Ve={class:"flex items-center gap-2"},je={class:"actions flex max-sm:flex-col gap-5"},ze={class:"flex gap-5 lg:w-[450px]"},Le={class:"flex gap-5"},Ye=L({__name:"index",emits:["update:changeDate","update:changeStatus","searchCompanyName"],setup($,{emit:y}){const h=y,i=m(""),r=m([]),a=m(""),v=c=>{i.value=c,h("update:changeDate",i.value)},x=(c,t)=>{t?r.value.push(c):r.value=r.value.filter(l=>l!==c),h("update:changeStatus",r.value)};return(c,t)=>{const l=ne,p=H,k=J,D=Ae;return _(),g("div",Ne,[e("div",Ue,[e("div",Ie,[d(l,{id:"search",type:"text",placeholder:"Search...",class:"pl-10 w-[70%]",modelValue:n(a),"onUpdate:modelValue":t[0]||(t[0]=s=>X(a)?a.value=s:null),onKeydown:t[1]||(t[1]=fe(s=>h("searchCompanyName",n(a)),["enter"]))},null,8,["modelValue"]),e("span",Re,[d(n(re),{class:"w-4 h-4"})])]),e("div",Te,[e("div",Me,[d(p,{id:"normal",class:"bg-white","onUpdate:checked":t[2]||(t[2]=s=>x(1,s))}),t[5]||(t[5]=e("span",{for:"suspension",class:"flex text-xs flex-shrink-0"}," 利用中 ",-1))]),e("div",Pe,[d(p,{id:"terms",class:"bg-white","onUpdate:checked":t[3]||(t[3]=s=>x(2,s))}),t[6]||(t[6]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 停止中 ",-1))]),e("div",Ve,[d(p,{id:"temporary",class:"bg-white","onUpdate:checked":t[4]||(t[4]=s=>x(3,s))}),t[7]||(t[7]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 退会済み ",-1))])])]),e("div",je,[e("div",ze,[d(k,{variant:"export","left-icon":"search"},{default:j(()=>t[8]||(t[8]=[z(" 新規顧客追加 ")])),_:1}),d(k,{variant:"export","left-icon":"search"},{default:j(()=>t[9]||(t[9]=[z(" 顧客情報出力 ")])),_:1})]),e("div",Le,[d(D,{"onUpdate:selectedDate":v}),d(k,{variant:"export","left-icon":"search"},{default:j(()=>t[10]||(t[10]=[z(" 利用状況出力 ")])),_:1})])])])}}}),Be=Y(Ye,[["__scopeId","data-v-2b970d65"]]),Ee={class:"pagination max-w-[350px]"},Oe={class:"flex items-center gap-5 justify-between"},Fe={class:"flex items-center gap-2"},Ge={class:"text-center"},Ke={key:0,class:"dropdown-content absolute left-0 mt-1 w-full bg-white shadow-xl z-12"},qe=["onClick"],He={class:"flex items-center gap-2"},Je={key:0,class:"from"},Qe={key:1},We={key:2},Xe={key:3,class:"to"},Ze={key:4},et={key:5,class:"total"},tt={class:"flex items-center gap-2"},st=["disabled"],at=["disabled"],nt=L({__name:"pagination",props:{length:{type:Number,default:100}},emits:["update:pagination"],setup($,{emit:y}){const h=$,{length:i}=ve(h),r=m("30"),a=m(1),v=[30,100,200],x=m(!1),c=m(null),t=y,l=S(()=>Math.ceil(i.value/parseInt(r.value))),p=S(()=>i.value===0?0:(a.value-1)*parseInt(r.value)+1),k=S(()=>{if(i.value===0)return 0;const w=a.value*parseInt(r.value);return w>i.value?i.value:w}),D=w=>{r.value=w.toString(),a.value=1,x.value=!1,t("update:pagination",{pageIndex:a.value,pageSize:w})},s=()=>{a.value>1&&(a.value--,t("update:pagination",{pageIndex:a.value,pageSize:parseInt(r.value)}))},b=()=>{a.value<l.value&&(a.value++,t("update:pagination",{pageIndex:a.value,pageSize:parseInt(r.value)}))},A=S(()=>a.value>=l.value||i.value===0),U=w=>{c.value&&!c.value.contains(w.target)&&(x.value=!1)};return W(()=>{window.addEventListener("click",U)}),ge(()=>{window.removeEventListener("click",U)}),(w,C)=>(_(),g("div",Ee,[e("div",Oe,[e("div",Fe,[C[2]||(C[2]=e("span",null,"表示数:",-1)),e("div",{class:"relative",ref_key:"dropdownRef",ref:c},[e("button",{onClick:C[0]||(C[0]=I=>x.value=!x.value),class:"w-[60px] flex justify-between items-center px-2 py-1"},[e("span",Ge,f(r.value),1),C[1]||(C[1]=e("div",{class:"w-0 h-0 border-l-[5px] border-r-[5px] border-t-[5px] border-transparent border-t-gray-500 hover:border-t-gray-700"},null,-1))]),x.value?(_(),g("div",Ke,[e("ul",null,[(_(),g(E,null,O(v,I=>e("li",{key:I,onClick:F=>D(I),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},f(I),9,qe)),64))])])):M("",!0)],512),e("div",He,[n(i)>0?(_(),g("span",Je,f(p.value),1)):(_(),g("span",Qe,"0")),n(i)>0?(_(),g("span",We,"-")):M("",!0),n(i)>0?(_(),g("span",Xe,f(k.value)+" 件",1)):(_(),g("span",Ze,"件")),n(i)>0?(_(),g("span",et,"(全"+f(n(i))+"件)",1)):M("",!0)])]),e("div",tt,[e("button",{onClick:s,disabled:a.value===1||n(i)===0,class:"disabled:opacity-50"},[d(n(Q),{class:"w-4 h-4"})],8,st),e("button",{onClick:b,disabled:A.value,class:"disabled:opacity-50"},[d(n(we),{class:"w-4 h-4"})],8,at)])])]))}}),ot=Y(nt,[["__scopeId","data-v-f974aacb"]]),Z=xe("companyAdmin",()=>{const $=m(),y=m(!1);return{companyUsers:$,isLoadCompanyCustomers:y,bulkDelete:async r=>{var a;await((a=K.archaic)==null?void 0:a.del("company/bulk-delete",{companyIds:r}))},searchCompanies:async r=>{var v;y.value=!0;const a=await((v=K.archaic)==null?void 0:v.get(`company?${r}`));$.value=(a==null?void 0:a.data)??null,y.value=!1}}}),lt={class:"user-container flex flex-col gap-2 overflow-hidden"},rt={class:"actions flex justify-between items-center"},ct={class:"w-full flex flex-col relative border-l border-r"},it={class:"table-container overflow-auto border-b"},dt={class:"w-full table-fixed"},pt={class:"bg-[#afeeee] sticky top-0 z-10"},ut={class:"flex items-center justify-center px-4 py-[1px] text-black border-white border-r-2"},mt=["onClick"],_t={class:""},ht={class:"border-r border-[#52525200]"},ft={class:"row-sticky px-[5px]"},vt={class:"row-sticky px-[5px]"},gt={class:"px-[5px]"},xt={class:"px-[5px]"},yt={class:"px-[5px]"},bt={class:"px-[5px]"},kt={class:"px-[5px] text-center"},wt={class:"px-[5px] text-center"},St={class:"px-[5px] text-center"},$t=L({__name:"index",emits:["update:pagination","update:sort","getCompanies"],setup($,{emit:y}){const h=Z(),i=ye(),r=be(),{toast:a}=ce(),v=y,x={1:"利用中",2:"停止中",3:"退会済み"},c=[{label:"法人名",width:"10%",isSort:!0,key:"companyName"},{label:"所在地",width:"15%",isSort:!0,key:"companyAddress"},{label:"電話番号",width:"9%",isSort:!0,key:"phoneNumber"},{label:"代表者",width:"9%",isSort:!0,key:"frontPicFamilyName"},{label:"担当者",width:"9%",isSort:!0,key:"picFamilyName"},{label:"メールアドレス",width:"15%",isSort:!0,key:"email"},{label:"介護ソフト",width:"10%",isSort:!0,key:"kaigoSoftware"},{label:"ステータス",width:"9%",isSort:!0,key:"status"},{label:"開始日",width:"9%",isSort:!0,key:"createdAt"}],t=m(""),l=S(()=>{var o;return((o=h.companyUsers)==null?void 0:o.results)??[]}),p=S(()=>{var o;return((o=h.companyUsers)==null?void 0:o.totalRecord)??0}),k=S(()=>h.isLoadCompanyCustomers),D=S(()=>i.notify),s=m(new Set),b=S(()=>l.value.length>0&&s.value.size===l.value.length),A=()=>{b.value?s.value.clear():s.value=new Set(l.value.map(o=>o.id))},U=o=>{s.value.has(o)?s.value.delete(o):s.value.add(o)},w=o=>o?x[o]:o=0,C=({pageIndex:o,pageSize:N})=>{v("update:pagination",{pageIndex:o,pageSize:N})},I=o=>{if(!o.isSort)return;const[N,R]=t.value.split(":"),T=N===o.key?R===V.ASC?V.DESC:"":V.ASC;t.value=T?`${o.key}:${T}`:"",v("update:sort",t.value)},F=()=>{r.push("/customer/register-member")},ee=async()=>{var R;const o=Array.from(s.value);if(!o.length){G("destructive","削除する会社を選択してください");return}if(h.isLoadCompanyCustomers=!0,await h.bulkDelete(o),(R=D.value)!=null&&R.message){h.isLoadCompanyCustomers=!1;return}G("default","会社を削除しました"),v("getCompanies")},G=(o,N)=>{a({description:N,variant:o})};return(o,N)=>{const R=ot,T=H,te=ue,se=me;return _(),g("div",lt,[e("div",rt,[e("div",{class:"flex"},[e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:F},"編集"),e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:ee},"削除")]),d(R,{class:"mr-10",length:n(p),"onUpdate:pagination":C},null,8,["length"])]),e("div",ct,[e("div",it,[e("table",dt,[e("thead",pt,[e("tr",null,[e("th",null,[e("span",ut,[d(T,{id:"select-all",class:"bg-white flex items-center justify-center mx-4 text-black border border-gray-300",checked:n(b),"onUpdate:checked":A},null,8,["checked"])])]),(_(),g(E,null,O(c,(u,P)=>e("th",{class:"py-3",key:P,style:ke({width:u.width})},[e("span",{class:q(["flex items-center justify-center px-4 text-black border-white cursor-pointer",P<c.length-1?"border-r-2":""]),onClick:ae=>I(u)},[z(f(u.label)+" ",1),n(t)&&n(t).split(":")[1]==("SORT"in o?o.SORT:n(V)).ASC&&u.key==n(t).split(":")[0]?(_(),B(n(ie),{key:0,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):M("",!0),n(t)&&n(t).split(":")[1]==("SORT"in o?o.SORT:n(V)).DESC&&u.key==n(t).split(":")[0]?(_(),B(n(de),{key:1,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):M("",!0)],10,mt)],4)),64))])]),e("tbody",_t,[(_(!0),g(E,null,O(n(l),(u,P)=>(_(),g("tr",{key:P,class:q(["bg-white dark:bg-gray-800 h-10 hover:cursor-pointer hover:bg-[#afe7ee47]",[P<n(l).length-1?"border-b":""]])},[e("td",ht,[d(T,{id:"select-row-"+u.id,class:"m-auto bg-white flex items-center justify-center text-black border border-gray-300",checked:n(s).has(u.id),"onUpdate:checked":ae=>U(u.id)},null,8,["id","checked","onUpdate:checked"])]),e("td",ft,[e("span",null,f(u.companyName),1)]),e("td",vt,[e("span",null,f(u.companyAddress),1)]),e("td",gt,[e("span",null,f(u.phoneNumber),1)]),e("td",xt,[e("span",null,f(u.frontPicFamilyName??"")+" "+f(u.frontPicGivenName??""),1)]),e("td",yt,[e("span",null,f(u.picFamilyName??"")+" "+f(u.picGivenName??""),1)]),e("td",bt,[e("span",null,f(u.email??""),1)]),e("td",kt,[e("span",null,f(u.kaigoSoftware),1)]),e("td",wt,[e("span",null,f(w(u.status)),1)]),e("td",St,[e("span",null,f(("formatDate"in o?o.formatDate:n(pe))(u.createdAt,"YYYY-MM-DD")),1)])],2))),128))])])]),n(k)?(_(),B(te,{key:0})):M("",!0)]),d(se,{class:"top-[5px]"})])}}}),Ct=Y($t,[["__scopeId","data-v-ae128143"]]),Dt={class:"user-list px-4"},At={class:"body-content flex py-4 w-full gap-2"},Lt=L({__name:"index",setup($){const y=m(1),h=m(30),i=m(""),r=m(""),a=m([]),v=m(""),x=Z(),c=async()=>{let s=`page=${y.value}&pageSize=${h.value}&createdAt=${r.value}`;i.value&&(s+=`&sort=${i.value}`),a.value.length&&a.value.forEach(b=>{s+=`&status=${b}`}),v.value&&(s+=`&keyword=${v.value}`),x.searchCompanies(s)},t=async({pageIndex:s,pageSize:b})=>{y.value=s,h.value=b,await c()},l=async s=>{i.value=s,await c()},p=async s=>{const[b,A]=s.split("/");r.value=`${b}-${A}-01`,await c()},k=async s=>{a.value=s,await c()},D=async s=>{v.value=s,await c()};return(s,b)=>{const A=Be,U=Ct;return _(),g("div",Dt,[b[0]||(b[0]=e("div",{class:"header flex items-center h-[40px] border-b border-b-[#e2e2e2]"},[e("span",{class:"text-base font-bold"},"顧客管理")],-1)),d(A,{"onUpdate:changeDate":p,"onUpdate:changeStatus":k,onSearchCompanyName:D}),e("div",At,[d(U,{class:"w-full","onUpdate:pagination":t,"onUpdate:sort":l,onGetCompanies:c})])])}}});export{Lt as default};
