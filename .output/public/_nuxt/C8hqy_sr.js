import{_ as he}from"./CUwpco5E.js";import{_ as ne}from"./DtCyQhVu.js";import{_ as re}from"./ByAL3Qlp.js";import{C as le,j as xe,V as ye,S as Se,u as ie,A as be,a as ke,f as Ce,_ as we}from"./C1BrfS4A.js";import{C as $e}from"./-86VHsUX.js";import{m as J,r as h,J as K,g as ce,o as g,c as C,a as e,b as f,w as F,p as s,d as B,t as y,H as ue,A as $,K as De,L as Ee,v as G,x as M,N as Z,O as Ue,h as Ne,E as W,G as X,n as de,y as Ie,P as Ae,D as ae,S as j,M as Le}from"./CB4bxIeX.js";import{_ as q}from"./DlAUqK2U.js";import{u as pe}from"./-zdIij8n.js";import{u as ee}from"./CEWdvkZ-.js";import{L as oe}from"./D-CYvzd8.js";import{C as ze}from"./CFk-HdoQ.js";import{_ as Me}from"./Ca_HQD1b.js";import{_ as Pe}from"./DcQ0Rtuk.js";import"./BURkpfbM.js";import"./BMLW2BGR.js";const Te={class:"date-search flex items-center gap-3"},Re={class:"flex items-center gap-2"},Oe={class:"border border-gray-300 h-[30px] flex items-center justify-between px-4 bg-white rounded cursor-pointer"},Ve=J({__name:"date",emits:["update:selectedDate"],setup(V,{emit:I}){const S=I,x=h((()=>{const v=new Date,c=v.getFullYear(),l=v.getMonth()+1;return{year:c,month:l}})()),n=h(""),r=()=>{const{year:v,month:c}=x.value;n.value=`${v}/${c.toString().padStart(2,"0")}`,S("update:selectedDate",n.value)},k=v=>{let{year:c,month:l}=x.value;l+=v,l>12?(l=1,c+=1):l<1&&(l=12,c-=1),i.value={year:c,month:l-1}};K(()=>{r()});const i=h({year:x.value.year,month:x.value.month-1});return ce(i,()=>{x.value={year:i.value.year,month:i.value.month+1},r()}),(v,c)=>{const l=re;return g(),C("div",Te,[e("div",Re,[f(l,{variant:"default",class:"bg-[#bfbfbf] text-black hover:bg-[#c4b3b3]","left-icon":"search",onClick:c[0]||(c[0]=b=>k(-1))},{default:F(()=>[f(s(le),{class:"w-4 h-4"}),c[2]||(c[2]=B(" 前月 "))]),_:1}),f(s(ye),{modelValue:s(i),"onUpdate:modelValue":c[1]||(c[1]=b=>ue(i)?i.value=b:null),"month-picker":"","auto-apply":"","format-locale":s(xe),format:"E"},{trigger:F(()=>[e("div",Oe,[e("span",null,y(s(n)),1),f(s($e),{class:"w-4 h-4"})])]),_:1},8,["modelValue","format-locale"])])])}}}),Ye=q(Ve,[["__scopeId","data-v-0df9fc12"]]),je={class:"search flex flex-col gap-8 min-h-[100px]"},Fe={class:"company flex max-sm:flex-col gap-5"},Be={class:"relative items-center font-medium lg:w-[450px]"},Ge={class:"absolute start-0 inset-y-0 flex items-center justify-center px-2"},Je={class:"active flex gap-5"},Ke={class:"flex items-center gap-2"},He={class:"flex items-center gap-2"},qe={class:"flex items-center gap-2"},Qe={class:"actions flex max-sm:flex-col gap-5"},We={class:"flex gap-5 lg:w-[450px]"},Xe={class:"flex gap-5"},Ze=J({__name:"index",emits:["update:changeDate","update:changeStatus","searchCompany","exportCustomer","exportStatusCompany"],setup(V,{emit:I}){const{redirectPage:S}=pe(),u=ee(),x=Z(),n=I,r=h(""),k=h([]),i=h(""),v=h(!1),c=$(()=>u.isLoadingExportCompany),l=$(()=>u.isLoadingExportStatusCompany),b=$(()=>x.getCurrentUserFromStorage()),P=_=>{r.value=_,n("update:changeDate",r.value)},z=(_,a)=>{a?k.value.push(_):k.value=k.value.filter(L=>L!==_),n("update:changeStatus",k.value)},T=()=>{S("/customer/create-new-customer")},R=()=>{n("exportCustomer")},w=()=>{n("exportStatusCompany")},A=()=>{if(v.value){v.value=!1;return}n("searchCompany",i.value)},D=_=>{v.value=!0,_.target.blur(),n("searchCompany",i.value)};return K(()=>{var a;const _=x.getLocalStorage(`${(a=b.value)==null?void 0:a.id}_company_admin`);if(_){const L=JSON.parse(_);k.value=L.status,i.value=L.keyword}}),(_,a)=>{const L=he,o=ne,d=re,E=Ye;return g(),C("div",je,[e("div",Fe,[e("div",Be,[f(L,{id:"search",type:"text",placeholder:"Search...",class:"pl-10 w-[70%]",modelValue:s(i),"onUpdate:modelValue":a[0]||(a[0]=U=>ue(i)?i.value=U:null),onBlur:A,onKeydown:De(Ee(D,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),e("span",Ge,[f(s(Se),{class:"w-4 h-4"})])]),e("div",Je,[e("div",Ke,[f(o,{id:"normal",class:"bg-white",checked:s(k).includes(1),"onUpdate:checked":a[1]||(a[1]=U=>z(1,U))},null,8,["checked"]),a[4]||(a[4]=e("span",{for:"suspension",class:"flex text-xs flex-shrink-0"}," 利用中 ",-1))]),e("div",He,[f(o,{id:"terms",class:"bg-white",checked:s(k).includes(2),"onUpdate:checked":a[2]||(a[2]=U=>z(2,U))},null,8,["checked"]),a[5]||(a[5]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 停止中 ",-1))]),e("div",qe,[f(o,{id:"temporary",class:"bg-white",checked:s(k).includes(3),"onUpdate:checked":a[3]||(a[3]=U=>z(3,U))},null,8,["checked"]),a[6]||(a[6]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 退会済 ",-1))])])]),e("div",Qe,[e("div",We,[f(d,{variant:"export","left-icon":"search",class:"cursor-pointer",onClick:T},{default:F(()=>a[7]||(a[7]=[B(" 新規顧客追加 ")])),_:1}),f(d,{variant:"export","left-icon":"search",onClick:R},{default:F(()=>[s(c)?(g(),G(s(oe),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):M("",!0),a[8]||(a[8]=B(" 顧客情報出力 "))]),_:1})]),e("div",Xe,[f(E,{"onUpdate:selectedDate":P}),f(d,{variant:"export","left-icon":"search",onClick:w},{default:F(()=>[s(l)?(g(),G(s(oe),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):M("",!0),a[9]||(a[9]=B(" 利用状況出力 "))]),_:1})])])])}}}),et=q(Ze,[["__scopeId","data-v-55e44447"]]),tt={class:"pagination max-w-[350px]"},st={class:"flex items-center gap-5 justify-between"},at={class:"flex items-center gap-2"},ot={class:"text-center"},nt={key:0,class:"dropdown-content absolute left-0 mt-1 w-full bg-white shadow-xl z-12"},rt=["onClick"],lt={class:"flex items-center gap-2"},it={key:0,class:"from"},ct={key:1},ut={key:2},dt={key:3,class:"to"},pt={key:4},mt={key:5,class:"total"},gt={class:"flex items-center gap-2"},vt=["disabled"],_t=["disabled"],ft=J({__name:"pagination",props:{length:{type:Number,default:100},pagination:{type:Object,default:()=>({pageIndex:1,pageSize:30})}},emits:["update:pagination"],setup(V,{emit:I}){const S=V,{length:u}=Ue(S),x=$(()=>S.pagination),n=h(x.value.pageSize.toString()),r=h(x.value.pageIndex),k=[30,100,200],i=h(!1),v=h(null);ce(x,()=>{n.value=x.value.pageSize.toString(),r.value=x.value.pageIndex});const c=I,l=$(()=>Math.ceil(u.value/parseInt(n.value))),b=$(()=>u.value===0?0:(r.value-1)*parseInt(n.value)+1),P=$(()=>{if(u.value===0)return 0;const D=r.value*parseInt(n.value);return D>u.value?u.value:D}),z=D=>{n.value=D.toString(),r.value=1,i.value=!1,c("update:pagination",{pageIndex:r.value,pageSize:D})},T=()=>{r.value>1&&(r.value--,c("update:pagination",{pageIndex:r.value,pageSize:parseInt(n.value)}))},R=()=>{r.value<l.value&&(r.value++,c("update:pagination",{pageIndex:r.value,pageSize:parseInt(n.value)}))},w=$(()=>r.value>=l.value||u.value===0),A=D=>{v.value&&!v.value.contains(D.target)&&(i.value=!1)};return K(()=>{window.addEventListener("click",A)}),Ne(()=>{window.removeEventListener("click",A)}),(D,_)=>(g(),C("div",tt,[e("div",st,[e("div",at,[_[2]||(_[2]=e("span",null,"表示数:",-1)),e("div",{class:"relative",ref_key:"dropdownRef",ref:v},[e("button",{onClick:_[0]||(_[0]=a=>i.value=!i.value),class:"w-[60px] flex justify-between items-center px-2 py-1"},[e("span",ot,y(n.value),1),_[1]||(_[1]=e("div",{class:"w-0 h-0 border-l-[5px] border-r-[5px] border-t-[5px] border-transparent border-t-gray-500 hover:border-t-gray-700"},null,-1))]),i.value?(g(),C("div",nt,[e("ul",null,[(g(),C(W,null,X(k,a=>e("li",{key:a,onClick:L=>z(a),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},y(a),9,rt)),64))])])):M("",!0)],512),e("div",lt,[s(u)>0?(g(),C("span",it,y(b.value),1)):(g(),C("span",ct,"0")),s(u)>0?(g(),C("span",ut,"-")):M("",!0),s(u)>0?(g(),C("span",dt,y(P.value)+" 件",1)):(g(),C("span",pt,"件")),s(u)>0?(g(),C("span",mt,"(全"+y(s(u))+"件)",1)):M("",!0)])]),e("div",gt,[e("button",{onClick:T,disabled:r.value===1||s(u)===0,class:"disabled:opacity-50"},[f(s(le),{class:"w-4 h-4"})],8,vt),e("button",{onClick:R,disabled:w.value,class:"disabled:opacity-50"},[f(s(ze),{class:"w-4 h-4"})],8,_t)])])]))}}),ht=q(ft,[["__scopeId","data-v-3b5cf6f5"]]),xt={class:"user-container flex flex-col gap-2 overflow-hidden"},yt={class:"actions flex justify-between items-center"},St={class:"w-full flex flex-col relative border-l border-r"},bt={class:"table-container overflow-auto border-b"},kt={class:"w-full table-fixed"},Ct={class:"bg-[#afeeee] sticky top-0 z-10"},wt=["onClick"],$t={class:""},Dt=["onDblclick"],Et={class:"pr-[1px]"},Ut={class:"row-sticky px-[5px]"},Nt={class:"row-sticky px-[5px]"},It={class:"px-[5px]"},At={class:"px-[5px]"},Lt={class:"px-[5px]"},zt={class:"px-[5px]"},Mt={class:"px-[5px] text-center"},Pt={class:"px-[5px] text-center"},Tt={class:"px-[5px] text-center"},Rt={key:1},Ot={colspan:"9",class:"text-center py-4 text-[#5566da]"},Vt=J({__name:"index",emits:["update:pagination","update:sort","getCompanies"],setup(V,{emit:I}){const S=ee(),u=de(),x=Ie(),{redirectPage:n}=pe(),r=Z(),{toast:k}=ie(),i=I,v={1:"利用中",2:"停止中",3:"退会済"},c=[{label:"法人名",width:"10%",isSort:!0,key:"companyName"},{label:"所在地",width:"15%",isSort:!0,key:"companyAddress"},{label:"電話番号",width:"9%",isSort:!0,key:"phoneNumber"},{label:"代表者",width:"9%",isSort:!0,key:"frontPicFamilyName"},{label:"担当者",width:"9%",isSort:!0,key:"picFamilyName"},{label:"メールアドレス",width:"15%",isSort:!0,key:"email"},{label:"介護ソフト",width:"10%",isSort:!0,key:"kaigoSoftware"},{label:"ステータス",width:"9%",isSort:!0,key:"status"},{label:"開始日",width:"9%",isSort:!0,key:"createdAt"}],l=h(""),b=h(!1),P=$(()=>{var t;return((t=S.companyUsers)==null?void 0:t.totalRecord)??0}),z=$(()=>S.isLoadCompanyCustomers),T=$(()=>u.notify),R=$(()=>x.masterData),w=h(new Set),A=$(()=>{var t;return w.value=new Set,((t=S.companyUsers)==null?void 0:t.results)??[]}),D=$(()=>r.getCurrentUserFromStorage()),_=t=>{w.value.has(t)?w.value.delete(t):w.value.add(t)},a=t=>t?v[t]:t=0,L=({pageIndex:t,pageSize:m})=>{i("update:pagination",{pageIndex:t,pageSize:m})},o=t=>{if(!t.isSort)return;const[m,N]=l.value.split(":"),O=m===t.key?N===j.ASC?j.DESC:"":j.ASC;l.value=O?`${t.key}:${O}`:"",i("update:sort",l.value)},d=()=>{if(w.value.size==0){H("destructive","削除する会社を選択してください");return}b.value=!0},E=async()=>{var N;S.isLoadCompanyCustomers=!0,b.value=!1;const t=Array.from(w.value);if(await S.bulkDelete(t),(N=T.value)!=null&&N.message){S.isLoadCompanyCustomers=!1;return}H("default","会社を削除しました"),i("getCompanies")},U=()=>{if(w.value.size==0){H("destructive","編集する会社を選択してください");return}if(w.value.size>1){H("destructive","編集する会社を1つだけ選択してください");return}n(`/customer/detail/${w.value.values().next().value}`)},me=t=>{n(`/customer/detail/${t}`)},H=(t,m)=>{k({description:m,variant:t,duration:1e3})},ge=t=>{let m="bg-white dark:bg-gray-800 h-10 hover:cursor-pointer ";if(!t||t==1)return m+="hover:bg-[#afe7ee47]";if(t==2)return m+="!bg-[#feffce]";if(t==3)return m+="!bg-[#515151] text-white"},ve=t=>{var N,O;const m=(N=R.value)==null?void 0:N.kaigoSoftwares;return((O=m==null?void 0:m.find(Q=>Q.id==t))==null?void 0:O.name)??""},te=h({pageIndex:1,pageSize:30});return K(()=>{var m;const t=r.getLocalStorage(`${(m=D.value)==null?void 0:m.id}_company_admin`);if(t){const N=JSON.parse(t);te.value={pageIndex:1,pageSize:N.pageSize},l.value=N.sort}}),(t,m)=>{const N=ht,O=ne,Q=Me,_e=we,fe=Pe;return g(),C("div",xt,[e("div",yt,[e("div",{class:"flex"},[e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:U},"編集"),e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:d},"削除")]),f(N,{class:"mr-10",length:s(P),"onUpdate:pagination":L,pagination:s(te)},null,8,["length","pagination"])]),e("div",St,[e("div",bt,[e("table",kt,[e("thead",Ct,[e("tr",null,[m[1]||(m[1]=e("th",{class:"py-3"},[e("span",{class:"flex items-center justify-center px-4 text-black border-white cursor-pointer border-r-2 p-[9px]"})],-1)),(g(),C(W,null,X(c,(p,Y)=>e("th",{class:"py-3",key:Y,style:Ae({width:p.width})},[e("span",{class:ae(["flex items-center justify-center px-4 text-black border-white cursor-pointer",Y<c.length-1?"border-r-2":""]),onClick:se=>o(p)},[B(y(p.label)+" ",1),s(l)&&s(l).split(":")[1]==("SORT"in t?t.SORT:s(j)).ASC&&p.key==s(l).split(":")[0]?(g(),G(s(be),{key:0,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):M("",!0),s(l)&&s(l).split(":")[1]==("SORT"in t?t.SORT:s(j)).DESC&&p.key==s(l).split(":")[0]?(g(),G(s(ke),{key:1,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):M("",!0)],10,wt)],4)),64))])]),e("tbody",$t,[s(A).length>0?(g(!0),C(W,{key:0},X(s(A),(p,Y)=>(g(),C("tr",{key:Y,class:ae([Y<s(A).length-1?"border-b":"",ge(p.status)]),onDblclick:se=>me(p.id)},[e("td",Et,[f(O,{id:"select-row-"+p.id,class:"m-auto bg-white flex items-center justify-center text-black border border-gray-300",checked:s(w).has(p.id),"onUpdate:checked":se=>_(p.id)},null,8,["id","checked","onUpdate:checked"])]),e("td",Ut,[e("span",null,y(p.companyName),1)]),e("td",Nt,[e("span",null,y(p.companyAddress),1)]),e("td",It,[e("span",null,y(p.phoneNumber),1)]),e("td",At,[e("span",null,y(p.frontPicFamilyName??"")+" "+y(p.frontPicGivenName??""),1)]),e("td",Lt,[e("span",null,y(p.picFamilyName??"")+" "+y(p.picGivenName??""),1)]),e("td",zt,[e("span",null,y(p.email??""),1)]),e("td",Mt,[e("span",null,y(ve(p.kaigoSoftware)),1)]),e("td",Pt,[e("span",null,y(a(p.status)),1)]),e("td",Tt,[e("span",null,y(("formatDate"in t?t.formatDate:s(Ce))(p.createdAt,"YYYY-MM-DD")),1)])],42,Dt))),128)):M("",!0),s(A).length==0&&s(z)==!1?(g(),C("tr",Rt,[e("td",Ot,y(("MESSAGES"in t?t.MESSAGES:s(Le)).EMPTY),1)])):M("",!0)])])]),s(z)?(g(),G(Q,{key:0})):M("",!0)]),f(_e,{class:"top-[5px]"}),f(fe,{"is-open":s(b),onClose:m[0]||(m[0]=p=>b.value=!1),onUpdate:E},null,8,["is-open"])])}}}),Yt=q(Vt,[["__scopeId","data-v-5b8717eb"]]),jt={class:"user-list px-4"},Ft={class:"body-content flex py-4 w-full gap-2"},ns=J({__name:"index",setup(V){const I=h(1),S=h(30),u=h(""),x=h(""),n=h([]),r=h(""),k=ee(),i=de(),v=Z(),{toast:c}=ie(),l=$(()=>v.getCurrentUserFromStorage()),b=async()=>{const o=new URLSearchParams;o.append("page",I.value.toString()),o.append("pageSize",S.value.toString()),u.value&&o.append("sort",u.value),n.value.length&&n.value.forEach(d=>{o.append("status",d)}),r.value&&o.append("keyword",r.value),P(),await k.searchCompanies(o.toString())},P=()=>{var d;const o={page:I.value,pageSize:S.value,sort:u.value,status:n.value,keyword:r.value};v.setLocalStorage(`${(d=l.value)==null?void 0:d.id}_company_admin`,JSON.stringify(o))},z=async({pageIndex:o,pageSize:d})=>{I.value=o,S.value=d,await b()},T=async o=>{u.value=o,await b()},R=async o=>{const[d,E]=o.split("/");x.value=`${d}-${E}-01`},w=async o=>{n.value=o,await b()},A=async o=>{r.value=o,await b()},D=async()=>{a(0,"顧客情報ダウンロード用のリンクをメールで送信しました。")},_=async()=>{a(1,"利用状況ダウンロード用のリンクをメールで送信しました。")},a=async(o,d)=>{var U;const E={exportType:o,targetYearMonth:x.value,status:n.value,keyword:r.value};await k.exportCompanyCustomer(E),(U=i.notify)!=null&&U.message||L(d,"default")},L=(o,d)=>{c({description:o,variant:d,duration:1e3})};return K(async()=>{var d;const o=v.getLocalStorage(`${(d=l.value)==null?void 0:d.id}_company_admin`);if(o){const E=JSON.parse(o);S.value=E.pageSize,u.value=E.sort,n.value=E.status,r.value=E.keyword}await b()}),(o,d)=>{const E=et,U=Yt;return g(),C("div",jt,[d[0]||(d[0]=e("div",{class:"header flex items-center h-[40px] border-b border-b-[#e2e2e2]"},[e("span",{class:"text-base font-bold"},"顧客管理")],-1)),f(E,{"onUpdate:changeDate":R,"onUpdate:changeStatus":w,onSearchCompany:A,onExportCustomer:D,onExportStatusCompany:_}),e("div",Ft,[f(U,{class:"w-full","onUpdate:pagination":z,"onUpdate:sort":T,onGetCompanies:b})])])}}});export{ns as default};
