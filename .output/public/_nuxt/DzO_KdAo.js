import{_ as xe}from"./CN9j6agM.js";import{_ as ie}from"./CnswCTrw.js";import{_ as ce}from"./Ci5oW9mk.js";import{C as ue,j as ye,V as Se,S as Ce,u as de,A as be,a as ke,f as we,_ as $e}from"./B7MHAVMl.js";import{C as De}from"./BiA4czLV.js";import{m as J,r as v,I as H,g as Q,o as g,c as w,a as e,b as f,w as B,p as s,d as G,t as C,H as pe,J as Ee,A as E,K as Ue,L as Ne,N as Pe,v as K,x as z,O as Ie,h as Le,E as X,G as Z,n as me,y as Ae,Q as ze,D as re,S as Y,M as Me}from"./B-p9UkLm.js";import{_ as q}from"./DlAUqK2U.js";import{u as ge}from"./CieFXXK1.js";import{u as ee}from"./BTtBTRMe.js";import{L as le}from"./DHOjlfHk.js";import{C as Re}from"./43yz-GQ4.js";import{_ as Te}from"./CprVQSVR.js";import{_ as Oe}from"./DiMSOaHI.js";import"./V7UxMAHF.js";import"./CVfBR-YR.js";const je={class:"date-search flex items-center gap-3"},Fe={class:"flex items-center gap-2"},Ve={class:"border border-gray-300 h-[30px] flex items-center justify-between px-4 bg-white rounded cursor-pointer"},Ye=J({__name:"date",emits:["update:selectedDate"],setup(U,{emit:x}){const _=x,y=v((()=>{const h=new Date,u=h.getFullYear(),n=h.getMonth()+1;return{year:u,month:n}})()),l=v(""),a=()=>{const{year:h,month:u}=y.value;l.value=`${h}/${u.toString().padStart(2,"0")}`,_("update:selectedDate",l.value)},d=h=>{let{year:u,month:n}=y.value;n+=h,n>12?(n=1,u+=1):n<1&&(n=12,u-=1),c.value={year:u,month:n-1}};H(()=>{a()});const c=v({year:y.value.year,month:y.value.month-1});return Q(c,()=>{y.value={year:c.value.year,month:c.value.month+1},a()}),(h,u)=>{const n=ce;return g(),w("div",je,[e("div",Fe,[f(n,{variant:"default",class:"bg-[#bfbfbf] text-black hover:bg-[#c4b3b3]","left-icon":"search",onClick:u[0]||(u[0]=P=>d(-1))},{default:B(()=>[f(s(ue),{class:"w-4 h-4"}),u[2]||(u[2]=G(" 前月 "))]),_:1}),f(s(Se),{modelValue:s(c),"onUpdate:modelValue":u[1]||(u[1]=P=>pe(c)?c.value=P:null),"month-picker":"","auto-apply":"","format-locale":s(ye),format:"E"},{trigger:B(()=>[e("div",Ve,[e("span",null,C(s(l)),1),f(s(De),{class:"w-4 h-4"})])]),_:1},8,["modelValue","format-locale"])])])}}}),Be=q(Ye,[["__scopeId","data-v-0df9fc12"]]),te=Ee("customerPageStore",()=>{const U=v({page:1,pageSize:30,sort:"",status:[],keyword:""}),x=Ue(),_=E(()=>x.getCurrentUserFromStorage()),i=E(()=>{var a;return`${(a=_.value)==null?void 0:a.id}_company_admin`});return{customerStorageCondition:U,setCustomerStorageCondition:a=>{const d=x.getLocalStorage(i.value);if(d){const c=JSON.parse(d);U.value={...c,...a}}else U.value={...U.value,...a};x.setLocalStorage(i.value,JSON.stringify(U.value))},getCustomerStorageCondition:()=>{const a=x.getLocalStorage(i.value);if(a){const d=JSON.parse(a);U.value={...U.value,...d}}return U.value}}}),Ge={class:"search flex flex-col gap-8 min-h-[100px]"},Ke={class:"company flex max-sm:flex-col gap-5"},Je={class:"relative items-center font-medium lg:w-[450px]"},He={class:"absolute start-0 inset-y-0 flex items-center justify-center px-2"},Qe={class:"active flex gap-5"},qe={class:"flex items-center gap-2"},We={class:"flex items-center gap-2"},Xe={class:"flex items-center gap-2"},Ze={class:"actions flex max-sm:flex-col gap-5"},et={class:"flex gap-5 lg:w-[450px]"},tt={class:"flex gap-5"},st=J({__name:"index",emits:["update:changeDate","update:changeStatus","searchCompany","exportCustomer","exportStatusCompany"],setup(U,{emit:x}){const{redirectPage:_}=ge(),i=ee(),y=te(),l=x,a=v(""),d=v([]),c=v(""),h=v(!1),u=E(()=>i.isLoadingExportCompany),n=E(()=>i.isLoadingExportStatusCompany),P=b=>{a.value=b,l("update:changeDate",a.value)},M=(b,r)=>{r?d.value.push(b):d.value=d.value.filter(A=>A!==b),l("update:changeStatus",d.value)},T=()=>{_("/customer/create-new-customer")},O=()=>{l("exportCustomer")},j=()=>{l("exportStatusCompany")},$=()=>{if(h.value){h.value=!1;return}l("searchCompany",c.value)},L=b=>{h.value=!0,b.target.blur(),l("searchCompany",c.value)},k=E(()=>y.customerStorageCondition);return Q(k,()=>{d.value=k.value.status,c.value=k.value.keyword}),(b,r)=>{const A=xe,o=ie,m=ce,N=Be;return g(),w("div",Ge,[e("div",Ke,[e("div",Je,[f(A,{id:"search",type:"text",placeholder:"Search...",class:"pl-10 w-[70%]",modelValue:s(c),"onUpdate:modelValue":r[0]||(r[0]=D=>pe(c)?c.value=D:null),onBlur:$,onKeydown:Ne(Pe(L,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),e("span",He,[f(s(Ce),{class:"w-4 h-4"})])]),e("div",Qe,[e("div",qe,[f(o,{id:"normal",class:"bg-white",checked:s(d).includes(1),"onUpdate:checked":r[1]||(r[1]=D=>M(1,D))},null,8,["checked"]),r[4]||(r[4]=e("span",{for:"suspension",class:"flex text-xs flex-shrink-0"}," 利用中 ",-1))]),e("div",We,[f(o,{id:"terms",class:"bg-white",checked:s(d).includes(2),"onUpdate:checked":r[2]||(r[2]=D=>M(2,D))},null,8,["checked"]),r[5]||(r[5]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 停止中 ",-1))]),e("div",Xe,[f(o,{id:"temporary",class:"bg-white",checked:s(d).includes(3),"onUpdate:checked":r[3]||(r[3]=D=>M(3,D))},null,8,["checked"]),r[6]||(r[6]=e("span",{for:"terms",class:"flex text-xs flex-shrink-0"}," 退会済 ",-1))])])]),e("div",Ze,[e("div",et,[f(m,{variant:"export","left-icon":"search",class:"cursor-pointer",onClick:T},{default:B(()=>r[7]||(r[7]=[G(" 新規顧客追加 ")])),_:1}),f(m,{variant:"export","left-icon":"search",onClick:O},{default:B(()=>[s(u)?(g(),K(s(le),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):z("",!0),r[8]||(r[8]=G(" 顧客情報出力 "))]),_:1})]),e("div",tt,[f(N,{"onUpdate:selectedDate":P}),f(m,{variant:"export","left-icon":"search",onClick:j},{default:B(()=>[s(n)?(g(),K(s(le),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):z("",!0),r[9]||(r[9]=G(" 利用状況出力 "))]),_:1})])])])}}}),ot=q(st,[["__scopeId","data-v-234c82ab"]]),at={class:"pagination max-w-[350px]"},nt={class:"flex items-center gap-5 justify-between"},rt={class:"flex items-center gap-2"},lt={class:"text-center"},it={key:0,class:"dropdown-content absolute left-0 mt-1 w-full bg-white shadow-xl z-12"},ct=["onClick"],ut={class:"flex items-center gap-2"},dt={key:0,class:"from"},pt={key:1},mt={key:2},gt={key:3,class:"to"},vt={key:4},ft={key:5,class:"total"},_t={class:"flex items-center gap-2"},ht=["disabled"],xt=["disabled"],yt=J({__name:"pagination",props:{length:{type:Number,default:100},pagination:{type:Object,default:()=>({pageIndex:1,pageSize:30})}},emits:["update:pagination"],setup(U,{emit:x}){const _=U,{length:i}=Ie(_),y=E(()=>_.pagination),l=v(y.value.pageSize.toString()),a=v(y.value.pageIndex),d=[30,100,200],c=v(!1),h=v(null);Q(y,()=>{l.value=y.value.pageSize.toString(),a.value=y.value.pageIndex});const u=x,n=E(()=>Math.ceil(i.value/parseInt(l.value))),P=E(()=>i.value===0?0:(a.value-1)*parseInt(l.value)+1),M=E(()=>{if(i.value===0)return 0;const k=a.value*parseInt(l.value);return k>i.value?i.value:k}),T=k=>{l.value=k.toString(),a.value=1,c.value=!1,u("update:pagination",{pageIndex:a.value,pageSize:k})},O=()=>{a.value>1&&(a.value--,u("update:pagination",{pageIndex:a.value,pageSize:parseInt(l.value)}))},j=()=>{a.value<n.value&&(a.value++,u("update:pagination",{pageIndex:a.value,pageSize:parseInt(l.value)}))},$=E(()=>a.value>=n.value||i.value===0),L=k=>{h.value&&!h.value.contains(k.target)&&(c.value=!1)};return H(()=>{window.addEventListener("click",L)}),Le(()=>{window.removeEventListener("click",L)}),(k,b)=>(g(),w("div",at,[e("div",nt,[e("div",rt,[b[2]||(b[2]=e("span",null,"表示数:",-1)),e("div",{class:"relative",ref_key:"dropdownRef",ref:h},[e("button",{onClick:b[0]||(b[0]=r=>c.value=!c.value),class:"w-[60px] flex justify-between items-center px-2 py-1"},[e("span",lt,C(l.value),1),b[1]||(b[1]=e("div",{class:"w-0 h-0 border-l-[5px] border-r-[5px] border-t-[5px] border-transparent border-t-gray-500 hover:border-t-gray-700"},null,-1))]),c.value?(g(),w("div",it,[e("ul",null,[(g(),w(X,null,Z(d,r=>e("li",{key:r,onClick:A=>T(r),class:"px-4 py-2 hover:bg-gray-100 cursor-pointer"},C(r),9,ct)),64))])])):z("",!0)],512),e("div",ut,[s(i)>0?(g(),w("span",dt,C(P.value),1)):(g(),w("span",pt,"0")),s(i)>0?(g(),w("span",mt,"-")):z("",!0),s(i)>0?(g(),w("span",gt,C(M.value)+" 件",1)):(g(),w("span",vt,"件")),s(i)>0?(g(),w("span",ft,"(全"+C(s(i))+"件)",1)):z("",!0)])]),e("div",_t,[e("button",{onClick:O,disabled:a.value===1||s(i)===0,class:"disabled:opacity-50"},[f(s(ue),{class:"w-4 h-4"})],8,ht),e("button",{onClick:j,disabled:$.value,class:"disabled:opacity-50"},[f(s(Re),{class:"w-4 h-4"})],8,xt)])])]))}}),St=q(yt,[["__scopeId","data-v-3b5cf6f5"]]),Ct={class:"user-container flex flex-col gap-2 overflow-hidden"},bt={class:"actions flex justify-between items-center"},kt={class:"w-full flex flex-col relative border-l border-r"},wt={class:"table-container overflow-auto border-b"},$t={class:"w-full table-fixed"},Dt={class:"bg-[#afeeee] sticky top-0 z-10"},Et=["onClick"],Ut={class:""},Nt=["onDblclick"],Pt={class:"pr-[1px]"},It={class:"row-sticky px-[5px]"},Lt={class:"row-sticky px-[5px]"},At={class:"px-[5px]"},zt={class:"px-[5px]"},Mt={class:"px-[5px]"},Rt={class:"px-[5px]"},Tt={class:"px-[5px] text-center"},Ot={class:"px-[5px] text-center"},jt={class:"px-[5px] text-center"},Ft={key:1},Vt={colspan:"9",class:"text-center py-4 text-[#5566da]"},Yt=J({__name:"index",emits:["update:pagination","update:sort","getCompanies"],setup(U,{emit:x}){const _=ee(),i=me(),y=Ae(),l=te(),{redirectPage:a}=ge(),{toast:d}=de(),c=x,h={1:"利用中",2:"停止中",3:"退会済"},u=[{label:"法人名",width:"10%",isSort:!0,key:"companyName"},{label:"所在地",width:"15%",isSort:!0,key:"companyAddress"},{label:"電話番号",width:"9%",isSort:!0,key:"phoneNumber"},{label:"代表者",width:"9%",isSort:!0,key:"frontPicFamilyName"},{label:"担当者",width:"9%",isSort:!0,key:"picFamilyName"},{label:"メールアドレス",width:"15%",isSort:!0,key:"email"},{label:"介護ソフト",width:"10%",isSort:!0,key:"kaigoSoftware"},{label:"ステータス",width:"9%",isSort:!0,key:"status"},{label:"開始日",width:"9%",isSort:!0,key:"createdAt"}],n=v(""),P=v(!1),M=E(()=>{var t;return((t=_.companyUsers)==null?void 0:t.totalRecord)??0}),T=E(()=>_.isLoadCompanyCustomers),O=E(()=>i.notify),j=E(()=>y.masterData),$=v(new Set),L=E(()=>{var t;return $.value=new Set,((t=_.companyUsers)==null?void 0:t.results)??[]}),k=t=>{$.value.has(t)?$.value.delete(t):$.value.add(t)},b=t=>t?h[t]:t=0,r=({pageIndex:t,pageSize:S})=>{c("update:pagination",{pageIndex:t,pageSize:S})},A=t=>{if(!t.isSort)return;const[S,R]=n.value.split(":"),F=S===t.key?R===Y.ASC?Y.DESC:"":Y.ASC;n.value=F?`${t.key}:${F}`:"",c("update:sort",n.value)},o=()=>{if($.value.size==0){I("destructive","削除する会社を選択してください");return}P.value=!0},m=async()=>{var R;_.isLoadCompanyCustomers=!0,P.value=!1;const t=Array.from($.value);if(await _.bulkDelete(t),(R=O.value)!=null&&R.message){_.isLoadCompanyCustomers=!1;return}I("default","会社を削除しました"),c("getCompanies")},N=()=>{if($.value.size==0){I("destructive","編集する会社を選択してください");return}if($.value.size>1){I("destructive","編集する会社を1つだけ選択してください");return}a(`/customer/detail/${$.value.values().next().value}`)},D=t=>{a(`/customer/detail/${t}`)},I=(t,S)=>{d({description:S,variant:t,duration:1e3})},ve=t=>{let S="bg-white dark:bg-gray-800 h-10 hover:cursor-pointer ";if(!t||t==1)return S+="hover:bg-[#afe7ee47]";if(t==2)return S+="!bg-[#feffce]";if(t==3)return S+="!bg-[#515151] text-white"},fe=t=>{var R,F;const S=(R=j.value)==null?void 0:R.kaigoSoftwares;return((F=S==null?void 0:S.find(W=>W.id==t))==null?void 0:F.name)??""},se=v({pageIndex:1,pageSize:30}),oe=E(()=>l.customerStorageCondition);Q(oe,()=>{ae(oe.value)}),H(()=>{const t=l.getCustomerStorageCondition();ae(t)});const ae=t=>{se.value={pageIndex:t.page,pageSize:t.pageSize},n.value=t.sort};return(t,S)=>{const R=St,F=ie,W=Te,_e=$e,he=Oe;return g(),w("div",Ct,[e("div",bt,[e("div",{class:"flex"},[e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:N},"編集"),e("span",{class:"px-5 py-1 border-l-2 border-[#e2e2e2] cursor-pointer",onClick:o},"削除")]),f(R,{class:"mr-10",length:s(M),"onUpdate:pagination":r,pagination:s(se)},null,8,["length","pagination"])]),e("div",kt,[e("div",wt,[e("table",$t,[e("thead",Dt,[e("tr",null,[S[1]||(S[1]=e("th",{class:"py-3"},[e("span",{class:"flex items-center justify-center px-4 text-black border-white cursor-pointer border-r-2 p-[9px]"})],-1)),(g(),w(X,null,Z(u,(p,V)=>e("th",{class:"py-3",key:V,style:ze({width:p.width})},[e("span",{class:re(["flex items-center justify-center px-4 text-black border-white cursor-pointer",V<u.length-1?"border-r-2":""]),onClick:ne=>A(p)},[G(C(p.label)+" ",1),s(n)&&s(n).split(":")[1]==("SORT"in t?t.SORT:s(Y)).ASC&&p.key==s(n).split(":")[0]?(g(),K(s(be),{key:0,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):z("",!0),s(n)&&s(n).split(":")[1]==("SORT"in t?t.SORT:s(Y)).DESC&&p.key==s(n).split(":")[0]?(g(),K(s(ke),{key:1,width:"12",height:"12",class:"ml-1 hover:text-[#5566da]"})):z("",!0)],10,Et)],4)),64))])]),e("tbody",Ut,[s(L).length>0?(g(!0),w(X,{key:0},Z(s(L),(p,V)=>(g(),w("tr",{key:V,class:re([V<s(L).length-1?"border-b":"",ve(p.status)]),onDblclick:ne=>D(p.id)},[e("td",Pt,[f(F,{id:"select-row-"+p.id,class:"m-auto bg-white flex items-center justify-center text-black border border-gray-300",checked:s($).has(p.id),"onUpdate:checked":ne=>k(p.id)},null,8,["id","checked","onUpdate:checked"])]),e("td",It,[e("span",null,C(p.companyName),1)]),e("td",Lt,[e("span",null,C(p.companyAddress),1)]),e("td",At,[e("span",null,C(p.phoneNumber),1)]),e("td",zt,[e("span",null,C(p.frontPicFamilyName??"")+" "+C(p.frontPicGivenName??""),1)]),e("td",Mt,[e("span",null,C(p.picFamilyName??"")+" "+C(p.picGivenName??""),1)]),e("td",Rt,[e("span",null,C(p.email??""),1)]),e("td",Tt,[e("span",null,C(fe(p.kaigoSoftware)),1)]),e("td",Ot,[e("span",null,C(b(p.status)),1)]),e("td",jt,[e("span",null,C(("formatDate"in t?t.formatDate:s(we))(p.createdAt,"YYYY-MM-DD")),1)])],42,Nt))),128)):z("",!0),s(L).length==0&&s(T)==!1?(g(),w("tr",Ft,[e("td",Vt,C(("MESSAGES"in t?t.MESSAGES:s(Me)).EMPTY),1)])):z("",!0)])])]),s(T)?(g(),K(W,{key:0})):z("",!0)]),f(_e,{class:"top-[5px]"}),f(he,{"is-open":s(P),onClose:S[0]||(S[0]=p=>P.value=!1),onUpdate:m},null,8,["is-open"])])}}}),Bt=q(Yt,[["__scopeId","data-v-229595a7"]]),Gt={class:"user-list px-4"},Kt={class:"body-content flex py-4 w-full gap-2"},is=J({__name:"index",setup(U){const x=v(1),_=v(30),i=v(""),y=v(""),l=v([]),a=v(""),d=ee(),c=me(),h=te(),{toast:u}=de(),n=async()=>{const o=new URLSearchParams;o.append("page",x.value.toString()),o.append("pageSize",_.value.toString()),i.value&&o.append("sort",i.value),l.value.length&&l.value.forEach(N=>{o.append("status",N)}),a.value&&o.append("keyword",a.value);const m={page:x.value,pageSize:_.value,sort:i.value,status:l.value,keyword:a.value};h.setCustomerStorageCondition(m),await d.searchCompanies(o.toString())},P=async({pageIndex:o,pageSize:m})=>{x.value=o,_.value=m,await n()},M=async o=>{i.value=o,await n()},T=async o=>{const[m,N]=o.split("/");y.value=`${m}-${N}-01`},O=async o=>{l.value=o,x.value=1,await n()},j=async o=>{a.value=o,x.value=1,await n()},$=async()=>{k(0,"顧客情報出力が完了しました。ファイルをダウンロードしてください。")},L=async()=>{k(1,"利用状況出力が完了しました。ファイルをダウンロードしてください。")},k=async(o,m)=>{var I;const N={exportType:o,targetYearMonth:y.value},D=await d.exportCompanyCustomer(N);if(!D){A("データのエクスポートに失敗","destructive");return}await b(D),(I=c.notify)!=null&&I.message||A(m,"default")},b=async o=>{try{const m=r(o),N=await fetch(o);if(!N.ok||!m){A("データのエクスポートに失敗","destructive");return}const D=await N.blob(),I=document.createElement("a");I.href=URL.createObjectURL(D),I.download=m,document.body.appendChild(I),I.click(),document.body.removeChild(I)}catch{A("データのエクスポートに失敗","destructive")}},r=o=>o.split("/").pop(),A=(o,m)=>{d.resetLoadingExport(),u({description:o,variant:m,duration:1e3})};return H(async()=>{const o=h.getCustomerStorageCondition();o&&(x.value=o.page,_.value=o.pageSize,i.value=o.sort,l.value=o.status,a.value=o.keyword),await n()}),(o,m)=>{const N=ot,D=Bt;return g(),w("div",Gt,[m[0]||(m[0]=e("div",{class:"header flex items-center h-[40px] border-b border-b-[#e2e2e2]"},[e("span",{class:"text-base font-bold"},"顧客管理")],-1)),f(N,{"onUpdate:changeDate":T,"onUpdate:changeStatus":O,onSearchCompany:j,onExportCustomer:$,onExportStatusCompany:L}),e("div",Kt,[f(D,{class:"w-full","onUpdate:pagination":P,"onUpdate:sort":M,onGetCompanies:n})])])}}});export{is as default};
